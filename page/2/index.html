<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/ganru.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/ganru.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/ganru.github.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/ganru.github.io/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/ganru.github.io/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/ganru.github.io/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/ganru.github.io/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="学习一向都是孤独的，慢慢玩。">
<meta property="og:type" content="website">
<meta property="og:title" content="小黑屋">
<meta property="og:url" content="https://ganru.github.io/page/2/index.html">
<meta property="og:site_name" content="小黑屋">
<meta property="og:description" content="学习一向都是孤独的，慢慢玩。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小黑屋">
<meta name="twitter:description" content="学习一向都是孤独的，慢慢玩。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/ganru.github.io/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ganru.github.io/page/2/"/>





  <title>小黑屋</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/ganru.github.io/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小黑屋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/ganru.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/ganru.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-essay">
          <a href="/ganru.github.io/categories/随笔" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-terminal"></i> <br />
            
            随笔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-write">
          <a href="/ganru.github.io/categories/写作" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-edit"></i> <br />
            
            写作
          </a>
        </li>
      
        
        <li class="menu-item menu-item-read">
          <a href="/ganru.github.io/categories/阅读" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            阅读
          </a>
        </li>
      
        
        <li class="menu-item menu-item-study">
          <a href="/ganru.github.io/categories/学习" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-bookmark"></i> <br />
            
            学习
          </a>
        </li>
      
        
        <li class="menu-item menu-item-java">
          <a href="/ganru.github.io/categories/Java" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-coffee"></i> <br />
            
            Java
          </a>
        </li>
      
        
        <li class="menu-item menu-item-py_code">
          <a href="/ganru.github.io/categories/Python笔记" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-codiepie"></i> <br />
            
            Python
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ganru.github.io/ganru.github.io/posts/Python笔记/2018-10-30-数据可视化（第三部分）.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ganru">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/ganru.github.io/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黑屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/ganru.github.io/posts/Python笔记/2018-10-30-数据可视化（第三部分）.html" itemprop="url">数据可视化（第三部分）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-30T11:03:44+08:00">
                2018-10-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ganru.github.io/categories/Python笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Python笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>该笔记学习的内容均来自于《Python 编程：从入门到实践》，只是作为一个内容总纲，若需详细学习，可去百度网盘<a href="https://pan.baidu.com/share/init?surl=dFxjtXf" target="_blank" rel="noopener">下载</a> ，密码：7rup</p>
</blockquote>
<p>上一部分学习了如何下载数据，这次学习如何使用 API。</p>
<h1 id="使用-Web-API"><a href="#使用-Web-API" class="headerlink" title="使用 Web API"></a>使用 Web API</h1><p>我们这次使用的数据信息来自于 Github，我们编写一个程序，它自动下载 GitHub 上星级最高的 Python 项目的信息，并对这些信息进行可视化。<br>在此之前，我们先安装 requests 包：</p>
<p><code>pip install --user requests</code></p>
<h2 id="API-调用"><a href="#API-调用" class="headerlink" title="API 调用"></a>API 调用</h2><p>想要知道 API 调用啥样的，我们可以先在浏览器写入这个 URL：<a href="https://api.github.com/search/repositories?q=language:python&amp;sort=stars" target="_blank" rel="noopener">https://api.github.com/search/repositories?q=language:python&amp;sort=stars</a></p>
<ul>
<li>这个调用返回 GitHub 当前托管了多少个 Python 项目，还有有关最受欢迎的 Python 仓库的信息。下面来仔细研究这个调用。第一部分（<a href="https://api.github.com/" target="_blank" rel="noopener">https://api.github.com/</a> ）将请求发送到 GitHub 网站中响应 API 调用的部分；接下来的一部分（search/repositories）让 API 搜索 GitHub 上的所有仓库。</li>
<li>repositories 后面的问号指出我们要传递一个实参。 q 表示查询，而等号让我们能够开始指定查询（q=）。通过使用 language:python，我们指出只想获取主要语言为 Python 的仓库的信息。最后一部分（&amp;sort=stars）指定将项目按其获得的星级进行排序。</li>
</ul>
<p>返回结果：</p>
<pre><code>{
    &quot;total_count&quot;: 3131505,
    &quot;incomplete_results&quot;: false,
    &quot;items&quot;: [
        {
            &quot;id&quot;: 21289110,
            &quot;node_id&quot;: &quot;MDEwOlJlcG9zaXRvcnkyMTI4OTExMA==&quot;,
            &quot;name&quot;: &quot;awesome-python&quot;,
            &quot;full_name&quot;: &quot;vinta/awesome-python&quot;,
            &quot;private&quot;: false,
            &quot;owner&quot;: {
            &quot;login&quot;: &quot;vinta&quot;,
            &quot;id&quot;: 652070,
            --snip--
    ]
    --snip--
}
</code></pre><p>从第二行输出可知，截止至 18.10.26，有 3131505 个 Python 项目，”incomplete_results” 的值为 false，据此我们知道请求是成功的（它并非不完整的）。倘若 GitHub 无法全面处理该 API，它返回的这个值将为 true。接下来的列表中显示了返回的 “items”，其中包含 GitHub 上最受欢迎的 Python 项目的详细信息。</p>
<h2 id="处理-API-响应"><a href="#处理-API-响应" class="headerlink" title="处理 API 响应"></a>处理 API 响应</h2><p><strong>python_repos.py</strong></p>
<hr>
<pre><code>import requests

# 执行 API 调用并存储响应
url = &apos;https://api.github.com/search/repositories?q=language:python&amp;sort=stars&apos;
r = requests.get(url)
print(&quot;Status code: &quot;, r.status_code)

# 将 API 响应存储在一个变量中
response_dict = r.json()

# 处理结果
print(response_dict.keys())




#-----------------------------
输出结果：
Status code:  200
dict_keys([&apos;total_count&apos;, &apos;incomplete_results&apos;, &apos;items&apos;])
</code></pre><p>这个 API 返回 JSON 格式的信息，因此我们使用方法 json() 将这些信息转换为一个 Python 字典。<br>状态码为 200，说明请求成功了。响应字典只包含三个键： ‘items’、 ‘total_count’ 和 ‘incomplete_results’。</p>
<h2 id="处理响应字典"><a href="#处理响应字典" class="headerlink" title="处理响应字典"></a>处理响应字典</h2><p>将 API 调用返回的信息存储到字典中后，就可以处理这个字典中的数据了。</p>
<pre><code># 指出 Github 共含有多少个 Python 库
print(&quot;Total repositories:&quot;, response_dict[&apos;total_count&apos;])
# total_count 指 API 返回调查到的 GitHub 有多少个 python 仓库

# 探索有关仓库的信息
repo_dicts = response_dict[&apos;items&apos;]
print(&quot;Repositories returned:&quot;, len(repo_dicts))

# 研究第一个仓库
repo_dict = repo_dicts[0]
print(&quot;\nKeys:&quot;, len(repo_dict))
for key in sorted(repo_dict.keys()):
    print(key)
</code></pre><p>与 ‘items’ 相关联的值是一个列表，其中包含很多字典，而每个字典都包含有关一个 Python 仓库的信息。打印 repo_dicts 的长度，以获悉我们获得了多少个仓库的信息。</p>
<p>运行后结果如下：</p>
<pre><code>Status code:  200
Total repositories: 3133850
Repositories returned: 30
# 注意：这里打印出来的 30 其实是我们所获得到的仓库数量，不可能全部仓库都给你展现出来

Keys: 73
archive_url
archived
assignees_url
blobs_url
branches_url
clone_url
collaborators_url
--snip--
url
watchers
watchers_count
dict_keys([&apos;total_count&apos;, &apos;incomplete_results&apos;, &apos;items&apos;])
</code></pre><p>可看到第一个仓库包含 73 个键，通过仔细查看这些键，可大致知道可提取有关项目的哪些信息（要准确地获悉API将返回哪些信息，要么阅读文档，要么像此处这样使用代码来查看这些信息）。</p>
<p>接下来我们提取 repo_dict 中与一些键相关联的值：</p>
<pre><code># 研究第一个仓库
repo_dict = repo_dicts[0]

print(&quot;\nSelected information about first repository:&quot;)
print(&apos;Name:&apos;, repo_dict[&apos;name&apos;])
print(&apos;Owner:&apos;, repo_dict[&apos;owner&apos;][&apos;login&apos;])
print(&apos;Stars:&apos;, repo_dict[&apos;stargazers_count&apos;])
print(&apos;Repository:&apos;, repo_dict[&apos;html_url&apos;])
print(&apos;Created:&apos;, repo_dict[&apos;created_at&apos;])
print(&apos;Updated:&apos;, repo_dict[&apos;updated_at&apos;])
print(&apos;Description:&apos;, repo_dict[&apos;description&apos;])
</code></pre><p>运行后结果如下：</p>
<pre><code>Status code:  200
Total repositories: 3133913
Repositories returned: 30

Selected information about first repository:
Name: awesome-python
Owner: vinta
Stars: 56752
Repository: https://github.com/vinta/awesome-python
Created: 2014-06-27T21:00:06Z
Updated: 2018-10-27T08:12:02Z
Description: A curated list of awesome Python frameworks, libraries, software and resources
</code></pre><p>从上述可知，写这篇文章时，GitHub 上星级最高的 Python 项目为 awesome-python。其所有者是 vinta。拿到了 56752 颗星星。以及该项目的 URL、创建日期以及最后更新日期。最后还描述了该项目用途。</p>
<h2 id="概述最受欢迎的仓库"><a href="#概述最受欢迎的仓库" class="headerlink" title="概述最受欢迎的仓库"></a>概述最受欢迎的仓库</h2><p>现在，把上面的代码稍加修改一下，加个 for 循环以期输出 30 个仓库的信息：</p>
<pre><code>for repo_dict in repo_dicts:
    print(&apos;Name:&apos;, repo_dict[&apos;name&apos;])
    print(&apos;Owner:&apos;, repo_dict[&apos;owner&apos;][&apos;login&apos;])
    print(&apos;Stars:&apos;, repo_dict[&apos;stargazers_count&apos;])
    print(&apos;Repository:&apos;, repo_dict[&apos;html_url&apos;])
    print(&apos;Created:&apos;, repo_dict[&apos;created_at&apos;])
    print(&apos;Updated:&apos;, repo_dict[&apos;updated_at&apos;])
    print(&apos;Description:&apos;, repo_dict[&apos;description&apos;])
</code></pre><p>运行无误的话应该是全都能显示，现在不细究这个。</p>
<h2 id="监视-API-的速率限制"><a href="#监视-API-的速率限制" class="headerlink" title="监视 API 的速率限制"></a>监视 API 的速率限制</h2><p>大多数 API 都存在速率限制，即我们在特定时间内可执行的请求数存在限制。<br>要获悉我们是否接近了 GitHub 的限制，在浏览器中输入<a href="https://api.github.com/rate_limit" target="_blank" rel="noopener">https://api.github.com/rate_limit</a> ，我们将看到类似于下面的响应：</p>
<pre><code>{
  &quot;resources&quot;: {
    &quot;core&quot;: {
      &quot;limit&quot;: 60,
      &quot;remaining&quot;: 60,
      &quot;reset&quot;: 1540652828
    },
    &quot;search&quot;: {
      &quot;limit&quot;: 10,
      &quot;remaining&quot;: 10,
      &quot;reset&quot;: 1540649288
    },
    &quot;graphql&quot;: {
      &quot;limit&quot;: 0,
      &quot;remaining&quot;: 0,
      &quot;reset&quot;: 1540652828
    }
  },
  &quot;rate&quot;: {
    &quot;limit&quot;: 60,
    &quot;remaining&quot;: 60,
    &quot;reset&quot;: 1540652828
  }
}
</code></pre><p>这里面，search 就是搜索速率的限制。可知：限制（limit）为每分钟 10 个请求，在当前这一分钟还余下 10 个请求能执行（remaining）。<br>reset 值指的是配额将重置的 Unix 时间或新纪元时间（1970年1月1日午夜后多少秒）。</p>
<h1 id="使用-Pygal-可视化仓库"><a href="#使用-Pygal-可视化仓库" class="headerlink" title="使用 Pygal 可视化仓库"></a>使用 Pygal 可视化仓库</h1><p>这时候我们导入 Pygal 包：</p>
<pre><code>import pygal
from pygal.style import LightColorizedStyle as LCS, LightenStyle as LS

names, stars = [], []
for repo_dict in repo_dicts:
    names.append(repo_dict[&apos;name&apos;])
    stars.append(repo_dict[&apos;stargazers_count&apos;])

# 直方图可视化
my_style = LS(&apos;#333366&apos;, base_style=LCS)
chart = pygal.Bar(style=my_style, x_label_rotation=45, show_legend=False)
chart.title = &apos;Most-Starred Python Projects on GitHub&apos;
chart.x_labels = names
chart.add(&apos;&apos;, stars)
chart.render_to_file(&apos;python_repos.svg&apos;)
</code></pre><p>这里的 <code>x_label_rotation=45, show_legend=False</code> 指标签绕 x 轴旋转45°，并隐藏图例（show_legend=False 不写或相反则默认打开）<br><code>chart.add(&#39;&#39;, stars)</code> ：导入数据，因为我们不需要给这个数据系列添加标签，加空字符串。</p>
<p>运行后结果如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-30-数据可视化（第三部分）/1.png"><br>至于上面说的隐藏图例是什么东西？看下图：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-30-数据可视化（第三部分）/2.png"></p>
<h2 id="图表的改进"><a href="#图表的改进" class="headerlink" title="图表的改进"></a>图表的改进</h2><p>我们看到， Bar() 里面含许多参数，但是还不够，我们要改进图表的样式，所以我们先创建一个 Pygal 类 Config 的实例：</p>
<pre><code># 表格式配置文件
my_config = pygal.Config()    # 配置对象
my_config.x_label_rotation = 45
my_config.show_legend = False    # 是否展示图例
my_config.title_font_size = 24    # 图表标题字体大小
my_config.label_font_size = 14    # #副标签字体大小
my_config.major_label_font_size = 18    # 主标签字体大小
my_config.truncate_label = 15    # 将裁剪较长字符到15个
my_config.show_y_guides = False    # 是否展示图标中水平线
my_config.width = 1000    # 自定义图表宽度

chart = pygal.Bar(my_config, style=my_style)    # my_config 必须在前，否则将会报错
</code></pre><p>书里是这么写的，但是其实看起来没什么变化，特别是字体大小，我不太明白，因此我采用下述代码：</p>
<pre><code>my_style.title_font_size = 24
my_style.label_font_size = 14
my_style.major_label_font_size = 18
</code></pre><p>以顶替上面的相关值，不知道你们是否会这样，我这里这两个代码结果都不同的：<br><strong>书中的代码：</strong><br><img src="/ganru.github.io/posts/Python笔记/2018-10-30-数据可视化（第三部分）/3.png"><br><strong>修改过的代码：</strong><br><img src="/ganru.github.io/posts/Python笔记/2018-10-30-数据可视化（第三部分）/4.png"></p>
<p>只有后面那个图跟书本相同。<br>如果你们也跟我一样，建议这样写配置代码。</p>
<p>在这个图表中，副标签是 x 轴上的项目名以及 y 轴上的大部分数字。主标签是 y 轴上为 50000 整数倍的刻度。</p>
<h2 id="添加自定义工具提示"><a href="#添加自定义工具提示" class="headerlink" title="添加自定义工具提示"></a>添加自定义工具提示</h2><p>在 Pygal 中，将鼠标指向条形将显示它表示的信息，这通常称为工具提示。<br>我们可以看到，我们导入数据的代码是 <code>chart.add(&#39;&#39;, stars)</code>，但是我们可以这么做：</p>
<pre><code>names, plot_dicts = [], []

for repo_dict in repo_dicts:
    names.append(repo_dict[&apos;name&apos;])

    &apos;&apos;&apos;
    Pygal 根据与键 &apos;value&apos; 相关联的数字来确定条形的高度，
    并使用与 &apos;label&apos; 相关联的字符串给条形创建工具提示。
    &apos;&apos;&apos;
    plot_dict = {
        &apos;value&apos;: repo_dict[&apos;stargazers_count&apos;],
        &apos;label&apos;: repo_dict[&apos;description&apos;],
        }
    plot_dicts.append(plot_dict)
</code></pre><p>把这个 <code>stars</code> 变为 <code>plot_dicts</code>，表示接收字典，这样不仅导入了 stars 值，还导入了 label （项目描述）。实现更多数据的可视化。<br>最后注意代码转换：<code>chart.add(&#39;&#39;, plot_dicts)</code></p>
<h2 id="在图表中添加可单击的链接"><a href="#在图表中添加可单击的链接" class="headerlink" title="在图表中添加可单击的链接"></a>在图表中添加可单击的链接</h2><p>我们要让图表可以与我们交互，比如，单击某一个条状，会在浏览器打开一个新的标签页，跳转到相应项目的 GitHub 页面。<br>很简单，加一行代码就行：</p>
<pre><code>plot_dict = {
    &apos;value&apos;: repo_dict[&apos;stargazers_count&apos;],
    &apos;label&apos;: repo_dict[&apos;description&apos;],
    &apos;xlink&apos;: repo_dict[&apos;html_url&apos;],
    }
</code></pre><h2 id="Hacker-News-API"><a href="#Hacker-News-API" class="headerlink" title="Hacker News API"></a>Hacker News API</h2><p>现在，我们探索如何使用其他网站的 API 调用。不过在此之前我们得了解一下 Hacker News API。<br>在 Hacker News 网站，用户分享编程和技术方面的文章，并就这些文章展开积极的讨论。 Hacker News 的 API 让我们能够访问有关该网站所有文章和评论的信息，且不要求我们通过注册获得密钥。<br>在浏览器看看这个网址：<a href="https://hacker-news.firebaseio.com/v0/item/9884165.json" target="_blank" rel="noopener">https://hacker-news.firebaseio.com/v0/item/9884165.json</a><br>注意，可能登不上去，需要 Over the wall（具体方法自行探索）<br>可以看到：</p>
<pre><code>{
&quot;by&quot;:&quot;nns&quot;,
&quot;descendants&quot;:297,
&quot;id&quot;:9884165,
&quot;kids&quot;:[9885099,9884723,9885165,9884789,9885604,9884137,9886151,9885220,9885790,9884661,9885844,9885029,9884817,9887342,9884545,9884372,9884499,9884881,9884109,9886496,9884342,9887832,9885023,9884334,9884707,9887008,9885348,9885131,9887539,9885880,9884196,9884640,9886534,9885152],
&quot;score&quot;:558,
&quot;time&quot;:1436875181,
&quot;title&quot;:&quot;New Horizons: Nasa spacecraft speeds past Pluto&quot;,
&quot;type&quot;:&quot;story&quot;,
&quot;url&quot;:&quot;http://www.bbc.co.uk/news/science-environment-33524589&quot;
}
</code></pre><p>这是一部字典。在这里 descendants 指文章被评论的次数。与键 ‘kids’ 相关联的值包含对文章所做的所有评论的 ID。</p>
<p>下面来执行一个 API 调用，返回 Hacker News 上当前热门文章的 ID，再查看每篇排名靠前的文章：<br><strong>hn_submissions.py</strong></p>
<hr>
<pre><code>import requests

from operator import itemgetter

# 执行 API 调用并存储响应
url = &apos;https://hacker-news.firebaseio.com/v0/topstories.json&apos;
r = requests.get(url)
print(&quot;Status code:&quot;, r.status_code)

# 处理有关每篇文章的信息
submission_ids = r.json()
submission_dicts = []
for submission_id in submission_ids[:30]:
    # 对于每篇文章，都执行一个 API 调用
    url = (&apos;https://hacker-news.firebaseio.com/v0/item/&apos; + 
        str(submission_id) + &apos;.json&apos;)
    submission_r = requests.get(url)
    print(&quot;Status code:&quot;, submission_r.status_code)
    # 检查下调用是否成功，成功则存储响应至变量
    response_dict = submission_r.json()

    submission_dict = {
        &apos;title&apos;: response_dict[&apos;title&apos;],
        &apos;link&apos;: &apos;http://news.ycombinator.com/item?id=&apos; + str(submission_id),
        &apos;comments&apos;: response_dict.get(&apos;descendants&apos;, 0)
        }
    submission_dicts.append(submission_dict)

submission_dicts = sorted(submission_dicts, key=itemgetter(&apos;comments&apos;), reverse=True)

for submission_dict in submission_dicts:
    print(&quot;\nTitle&quot;, submission_dict[&apos;title&apos;])
    print(&quot;Discussion link:&quot;, submission_dict[&apos;link&apos;])
    print(&quot;Comments&quot;, submission_dict[&apos;comments&apos;])
</code></pre><p>在最热门的 500 篇文章中提取 30 篇文章，然后把这每篇文章进行一次 API 调用并保存于变量中。<br><code>&#39;comments&#39;: response_dict.get(&#39;descendants&#39;, 0)</code>： 这里做了一点考量，如果是刚发的文章，无评论，即没有 ‘descendants’ 键，则导入我们制定的 0 作为评论数。<br>对对象 <code>submission_dicts</code> 完成导入后，我们再进行一次排序，以 ‘comments’ 为考量，对其进行降序排列。这里我们使用了模块 operator 中的函数 itemgetter()，该函数可以提取与键 ‘comments’ 相关联的值。</p>
<p>运行后结果如下：</p>
<pre><code>Status code: 200
Status code: 200
Status code: 200
--snip--

Title Facebook exodus: Nearly half of young users have deleted the app
Discussion link: http://news.ycombinator.com/item?id=18328750
Comments 459

Title With Proton and Steam Play, many Windows games now work on Linux
Discussion link: http://news.ycombinator.com/item?id=18327342
Comments 284

Title Identifying QUIC deliverables
Discussion link: http://news.ycombinator.com/item?id=18326658
Comments 168
--snip--
</code></pre><p>API 调用的具体操作方式就是如此。写好 url，并保存响应 <code>r = requests.get(url)</code>，然后将它以 json 格式保存在一个变量中，后面就可以自己发挥了。</p>
<h1 id="学习要点"><a href="#学习要点" class="headerlink" title="学习要点"></a>学习要点</h1><ol>
<li>如何使用 API 来编写独立的程序，它们自动采集所需的数据并对其进行可视化</li>
<li>使用 GitHub API 来探索 GitHub 上星级最高的 Python 项目</li>
<li>如何使用 requests 包来自动执行 GitHub API 调用，以及如何处理调用的结果</li>
<li>大致了解 Hacker News API</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ganru.github.io/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ganru">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/ganru.github.io/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黑屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）.html" itemprop="url">数据可视化（第二部分）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-24T16:51:08+08:00">
                2018-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ganru.github.io/categories/Python笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Python笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>该笔记学习的内容均来自于《Python 编程：从入门到实践》，只是作为一个内容总纲，若需详细学习，可去百度网盘<a href="https://pan.baidu.com/share/init?surl=dFxjtXf" target="_blank" rel="noopener">下载</a> ，密码：7rup</p>
</blockquote>
<p>上一部分我们学了如何生成数据，这一次，我们学习如何下载数据。</p>
<ul>
<li>数据可视化有两种常见的存储格式：CSV 和 JSON 。</li>
<li>处理 CSV 数据，我们用 Python 自带的模块 csv 处理。</li>
<li>处理 JSON 数据，我们用 模块 json 处理。</li>
<li>这一环节，我们依然使用 matplotlib 库与 pygal 库进行数据可视化。</li>
</ul>
<h1 id="CSV-文件格式"><a href="#CSV-文件格式" class="headerlink" title="CSV 文件格式"></a>CSV 文件格式</h1><p>csv 文件称为 逗号分隔值文件。其形式如下：</p>
<p><code>2014-1-5,61,44,26,18,7,-1,56,30,9,30.34,30.27,30.15,,,,10,4,,0.00,0,,195</code></p>
<h2 id="分析-CSV-文件头"><a href="#分析-CSV-文件头" class="headerlink" title="分析 CSV 文件头"></a>分析 CSV 文件头</h2><p><strong>highs_lows.py</strong></p>
<hr>
<pre><code>import csv

filename = &apos;sitka_weather_07-2014.csv&apos;
with open(filename) as f:
    reader = csv.reader(f)
    header_row = next(reader)
    print(header_row)
</code></pre><ul>
<li>文件名记得打 <strong>后缀</strong>。</li>
<li>创建一个阅读器 (reader) 对象并将之与 csv 文件关联。</li>
<li>模块 csv 包含函数 next()，调用它并将阅读器对象传递给它时，它将返回文件中的下一行。这里我们只调用第一行（头行）</li>
</ul>
<h2 id="打印文件头及其位置"><a href="#打印文件头及其位置" class="headerlink" title="打印文件头及其位置"></a>打印文件头及其位置</h2><p>为让文件头数据更容易理解，将列表中的每个文件头及其位置打印出来：</p>
<pre><code>import csv

filename = &apos;sitka_weather_07-2014.csv&apos;
with open(filename) as f:
    reader = csv.reader(f)
    header_row = next(reader)

    for index, column_header in enumerate(header_row):
        print(index, column_header)
</code></pre><ul>
<li>enumerate() 是 python 的内置函数</li>
<li>enumerate 在字典上是枚举、列举的意思</li>
<li>对于一个可迭代的（iterable）/可遍历的对象（如列表、字符串），enumerate 将其组成一个索引序列，利用它可以同时获得索引和值</li>
<li>enumerate 多用于在 for 循环中得到计数</li>
</ul>
<p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/1.png"></p>
<p>利用 enumerate() 函数，可以看到，我们直观地展现出了 csv 文件的数据。</p>
<p>文件头 AKDT 表示阿拉斯加时间（Alaska Daylight Time），其位置表明每行的第一个值都是日期或时间。文件头 Max TemperatureF 指出每行的第二个值都是当天的最高华氏温度。后面的自行翻译。。。</p>
<h2 id="提取并读取数据"><a href="#提取并读取数据" class="headerlink" title="提取并读取数据"></a>提取并读取数据</h2><p>知道需要哪些列中的数据后，我们来读取一些数据。首先读取每天的最高气温：</p>
<pre><code>with open(filename) as f:
    reader = csv.reader(f)
    header_row = next(reader)

    highs = []
    for row in reader:
        # 将第一列的数据添加到列表 highs
        highs.append(row[1])

    print(highs)
</code></pre><p>我们可以看到：</p>
<p>[‘64’, ‘71’, ‘64’, ‘59’, ‘69’, ‘62’, ‘61’, ‘55’, ‘57’, ‘61’, ‘57’, ‘59’, ‘57’, ‘61’, ‘64’, ‘61’, ‘59’, ‘63’, ‘60’, ‘57’, ‘69’, ‘63’, ‘62’, ‘59’, ‘57’, ‘57’, ‘61’, ‘59’, ‘61’, ‘61’, ‘66’]</p>
<p>有点儿不太好看，我们用 int() 将它们转换为数字，这样 matplotlib 才好访问它们：</p>
<pre><code>highs = []
for row in reader:
    high = int(row[1])
    highs.append(high)

print(highs)
</code></pre><p>这时候：</p>
<p>[64, 71, 64, 59, 69, 62, 61, 55, 57, 61, 57, 59, 57, 61, 64, 61, 59, 63, 60, 57, 69, 63, 62, 59, 57, 57, 61, 59, 61, 61, 66]</p>
<p>接下来将此数据可视化。</p>
<h2 id="绘制气温图表"><a href="#绘制气温图表" class="headerlink" title="绘制气温图表"></a>绘制气温图表</h2><pre><code>from matplotlib import pyplot as plt

# 根据数据绘制图形
fig = plt.figure(dpi=128, figsize=(10, 6))
plt.plot(highs, c=&apos;red&apos;)

# 设置图形的格式
plt.title(&quot;Daily high temperatures, July 2014&quot;, fontsize=24)
plt.xlabel(&apos;&apos;, fontsize=16)
plt.ylabel(&quot;Temperature (F)&quot;, fontsize=16)

plt.show()
</code></pre><p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/2.jpg"></p>
<h2 id="模块-datetime"><a href="#模块-datetime" class="headerlink" title="模块 datetime"></a>模块 datetime</h2><p>画好大致的温度折线图，现在我们添加上日期。在此之前我们先了解下模块 datetime 的用法：</p>
<pre><code>&gt;&gt;&gt; from datetime import datetime
&gt;&gt;&gt; first_date = datetime.strptime(&apos;2014-7-1&apos;, &apos;%Y-%m-%d&apos;)
&gt;&gt;&gt; print(first_date)
2014-07-01 00:00:00
</code></pre><p>在 IDLE 中编写，我们直观地看下它的做法：</p>
<ul>
<li>在这段演示中方法 strptime() 接收两个实参：前者是需要导入的日期的字符串，后者告诉 Python 如何设置日期的格式。</li>
<li>‘%Y-‘ 让 Python 将字符串中第一个连字符 - 前面的部分视为四位的年份</li>
<li>‘%m-‘ 让 Python 将第二个连字符 - 前面的部分视为表示月份的数字</li>
<li>‘%d’ 让 Python 将字符串的最后一部分视为月份中的一天 (0~31)</li>
</ul>
<p>方法 strptime() 可接受各种实参，并根据它们来决定如何解读日期。具体看下表：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/3.jpg"></p>
<p>现在我们尝试提取日期并导入绘制图中：</p>
<pre><code>import csv
from datetime import datetime

from matplotlib import pyplot as plt

with open(filename) as f:
    --snip--

    highs = []
    dates = []
    for row in reader:
        current_date = datetime.strptime(row[0], &quot;%Y-%m-%d&quot;)
        dates.append(current_date)

        high = int(row[1])
        highs.append(high)

    # 根据数据绘制图形
    fig = plt.figure(dpi=128, figsize=(10, 6))
    plt.plot(dates, highs, c=&apos;red&apos;)    # 修改

    --snip--
</code></pre><p>做出来好像不太对劲：</p>
<img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/4.jpg">
<p>日期重叠了。这时候我们可以调用 <code>fig.autofmt_xdate()</code> 来绘制斜的日期标签，以免它们彼此重叠。</p>
<pre><code># 设置图形的格式
plt.title(&quot;Daily high temperatures, July 2014&quot;, fontsize=24)
plt.xlabel(&apos;&apos;, fontsize=16)
fig.autofmt_xdate()    # 新增

--snip--
</code></pre><p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/5.jpg"></p>
<h2 id="涵盖更长时间"><a href="#涵盖更长时间" class="headerlink" title="涵盖更长时间"></a>涵盖更长时间</h2><p>现在，我们可以换另一个文件来读取了：</p>
<pre><code>filename = &apos;sitka_weather_2014.csv&apos;
# 设置图形的格式
plt.title(&quot;Daily high temperatures - 2014&quot;, fontsize=24)
</code></pre><p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/6.jpg"></p>
<h2 id="再绘制一个数据系列"><a href="#再绘制一个数据系列" class="headerlink" title="再绘制一个数据系列"></a>再绘制一个数据系列</h2><p>这时候，我们再导入最低气温数据：</p>
<pre><code>lows = []
for row in reader:
    --snip--
    low = int(row[3])
    lows.append(low)

plt.plot(dates, highs, c=&apos;red&apos;)
plt.plot(dates, lows, c=&apos;blue&apos;)

# 设置图形的格式
plt.title(&quot;Daily high and low temperatures - 2014&quot;, fontsize=24)
</code></pre><p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/7.jpg"></p>
<h2 id="绘图表区域着色"><a href="#绘图表区域着色" class="headerlink" title="绘图表区域着色"></a>绘图表区域着色</h2><p>使用方法 fill_between()，它接受一个 x 值系列和两个 y 值系列，并填充两个 y 值系列之间的空间：</p>
<pre><code>plt.plot(dates, highs, c=&apos;red&apos;, alpha=0.5)
plt.plot(dates, lows, c=&apos;blue&apos;, alpha=0.5)
plt.fill_between(dates, highs, lows, facecolor=&apos;blue&apos;, alpha=0.1)
</code></pre><ul>
<li><code>alpha</code> 指颜色的透明度。Alpha 值为 0 表示完全透明，1（默认设置）表示完全不透明。</li>
</ul>
<img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/8.jpg">
<p>我们看到，在俩温度之间填充了蓝色，并且俩条线颜色变浅了一些。</p>
<h2 id="错误检查"><a href="#错误检查" class="headerlink" title="错误检查"></a>错误检查</h2><p>我们上面引用的数据，都是很全的，但是我们去网上下载数据过来的时候，却不一定有这么全的数据，这时候要学会错误检查。</p>
<pre><code>filename = &apos;death_valley_2014.csv&apos;
</code></pre><p>这是有错误的文件。我们可以看到：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/9.png"></p>
<p>这时候，我们打开 csv 文件就知道了，这里有一天数据全无。它无法导入空字符串。<br>为了解决这种问题，我们用异常处理机制来解决：</p>
<pre><code>for row in reader:
    try:
        low = int(row[3])
        current_date = datetime.strptime(row[0], &quot;%Y-%m-%d&quot;)
        high = int(row[1])
    except ValueError:
        print(current_date, &apos;missing data&apos;)
    else:
        lows.append(low)
        dates.append(current_date)
        highs.append(high)
</code></pre><p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/10.png"></p>
<p><strong>感觉不对啊，怎么输出这个？这天不是有数据么？</strong></p>
<p>其实原因在这里：</p>
<pre><code>try:
    low = int(row[3])
    current_date = datetime.strptime(row[0], &quot;%Y-%m-%d&quot;)
    high = int(row[1])
</code></pre><p>在这里，先执行 <code>low = int(row[3])</code> ，然后才执行 <code>current_date = datetime.strptime(row[0], &quot;%Y-%m-%d&quot;)</code> 语句，这里就出现问题了：<br>本身该行就没有数据，执行前者的时候就报错了，后面的自然就不会执行，所以这时候时间 current_date 还停留在上一个正确的时间，错误的时间并没有导入进 current_date。<br>所以，报错的时候传导的是什么对象，就先把那个对象放在第一行：</p>
<pre><code>try:
    current_date = datetime.strptime(row[0], &quot;%Y-%m-%d&quot;)
    low = int(row[3])
    high = int(row[1])
</code></pre><p>再运行一下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/11.png"></p>
<p>运行正确。</p>
<p>其实不仅可以用 try-except-else 代码块来处理异常，在有些情况下，需要使用 continue 来跳过一些数据，或者使用 remove() 或 del 将已提取的数据删除。可采用任何管用的方法，只要能进行精确而有意义的可视化就好。</p>
<h1 id="制作世界人口地图：JSON-格式"><a href="#制作世界人口地图：JSON-格式" class="headerlink" title="制作世界人口地图：JSON 格式"></a>制作世界人口地图：JSON 格式</h1><p>在这一块，我们使用 json 格式的文件来进行数据可视化。</p>
<h2 id="数据提取"><a href="#数据提取" class="headerlink" title="数据提取"></a>数据提取</h2><p>我们打开 json 文件，可以看到：</p>
<pre><code>[
  {
    &quot;Country Name&quot;: &quot;Arab World&quot;,
    &quot;Country Code&quot;: &quot;ARB&quot;,
    &quot;Year&quot;: &quot;1960&quot;,
    &quot;Value&quot;: &quot;96388069&quot;
  },
  {
    &quot;Country Name&quot;: &quot;Arab World&quot;,
    &quot;Country Code&quot;: &quot;ARB&quot;,
    &quot;Year&quot;: &quot;1961&quot;,
    &quot;Value&quot;: &quot;98882541.4&quot;
  },
  --snip--
]
</code></pre><p>它相当于一个长长的 Python 列表，内嵌字典，字典中含有国家名、国别码、年份以及表示人口数量的值。</p>
<p>我们首先先编写打印这些信息的程序：<br><strong>world_population.py</strong></p>
<hr>
<pre><code>import json

# 将数据加载到一个列表中
filename = &apos;population_data.json&apos;
with open (filename) as f:
    pop_data = json.load(f)

# 打印每个国家2010年的人口数量
for pop_dict in pop_data:
    if pop_dict[&apos;Year&apos;] == &apos;2008&apos;:
        country_name = pop_dict[&apos;Country Name&apos;]
        population = pop_dict[&apos;Value&apos;]
        print(country_name + &quot;: &quot; + population)
</code></pre><ul>
<li>函数json.load()将数据转换为Python能够处理的格式，这里是一个列表。</li>
<li>检查字典的’Year’键对应的值是否是2008，这时候用引号括起来，因为观察得知 json 文件内这个是字符串而不是数值。</li>
</ul>
<p>这时候，我们可以看到它的输出：</p>
<pre><code>Arab World: 342077516.074643
Caribbean small states: 6802199
East Asia &amp; Pacific (all income levels): 2172955169.8192
East Asia &amp; Pacific (developing only): 1934412005
Euro area: 329523413

--snip--

Zambia: 12379612
Zimbabwe: 12451543
</code></pre><p>看起来好像正确的。但是还不够，Python 要实现数据可视化需要数值来处理。</p>
<pre><code>population = int(pop_dict[&apos;Value&apos;])
print(country_name + &quot;: &quot; + str(population))
</code></pre><p>出了点问题：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/12.png"></p>
<p>原来还有小数点的限制，但是我们用 float 的话数据有点不好看，全都有小数点，而且对于人口统计这类，还是整数好点。</p>
<p>将  <code>int(pop_dict[&#39;Value&#39;])</code> 变为 <code>int(float(pop_dict[&#39;Value&#39;]))</code></p>
<p>这时候，离制作地图不远了。</p>
<h2 id="获取两个字母的国别码"><a href="#获取两个字母的国别码" class="headerlink" title="获取两个字母的国别码"></a>获取两个字母的国别码</h2><p>制作地图前，还需要解决数据存在的最后一个问题。<br>Pygal 中的地图制作工具要求数据为特定的格式：用国别码表示国家，以及用数字表示人口数量。但是 json 文件中包含的是三个字母的国别码，但 Pygal 使用两个字母的国别码。<br>Pygal 使用的国别码存储在模块 i18n（internationalization 的缩写）中。字典 COUNTRIES 包含的键和值分别为两个字母的国别码和国家名。</p>
<p>现在，我们的做法是，使用自带的国别码与 json 文件的国别码对应：<br><strong>countries.py</strong></p>
<hr>
<pre><code>from pygal.i18n import COUNTRIES

for country_code in sorted(COUNTRIES.keys()):
    print(country_code, COUNTRIES[country_code])
</code></pre><p>sorted()：保留列表原始排序，同时以特定排序呈现原列表。<br>for 循环中，我们让 Python 将键按字母顺序排序（小到大）。</p>
<p>运行后如下：</p>
<pre><code>Traceback (most recent call last):
  File &quot;C:\Users\GR\Desktop\数据可视化\countries.py&quot;, line 1, in &lt;module&gt;
    from pygal.i18n import COUNTRIES
ModuleNotFoundError: No module named &apos;pygal.i18n&apos;
</code></pre><p>这里说没有这个模块？原书中，获取国别码是这个 pygal.i18n ，现在 pygal 没有这个模块了，我们只能这么做：</p>
<p><code>pip install pygal_maps_world</code></p>
<p>安装这个模块，然后将 <code>from pygal.i18n import COUNTRIES</code> 换成 <code>from pygal_maps_world.i18n import COUNTRIES</code> 就行了。<br>后面创建世界地图的时候也是，将库换一下。我们先看看 pygal_maps_world 库里面有什么：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/18.png"></p>
<p>运行后如下：</p>
<pre><code>ad Andorra
ae United Arab Emirates

--snip--

ye Yemen
yt Mayotte
za South Africa
zm Zambia
zw Zimbabwe
</code></pre><p>这时候我们自写一个函数用于国别码的对应：<br><strong>country_codes.py</strong></p>
<hr>
<pre><code>from pygal_maps_world.i18n import COUNTRIES

def get_country_code(country_name):
    &quot;&quot;&quot;根据指定的国家，返回Pygal使用的两个字母的国别码&quot;&quot;&quot;
    for code, name in COUNTRIES.items():
        if name == country_name:
            return code
    # 如果没有找到指定的国家，就返回 None
    return None

print(get_country_code(&apos;Andorra&apos;))
print(get_country_code(&apos;United Arab Emirates&apos;))
print(get_country_code(&apos;Afghanistan&apos;))
</code></pre><p>能正常输出就没问题，接下来删掉 print 语句继续编写（在<strong> world_population.py </strong>文件写）：</p>
<pre><code>from country_codes import get_country_code

--snip--

    population = int(float(pop_dict[&apos;Value&apos;]))
    code = get_country_code(country_name)
    if code:
        print(code + &quot;: &quot; + str(population))
    else:
        print(&apos;ERROR - &apos; + country_name)
</code></pre><p>运行后如下：</p>
<pre><code>ERROR - Arab World
ERROR - Caribbean small states
ERROR - East Asia &amp; Pacific (all income levels)
ERROR - East Asia &amp; Pacific (developing only)

--snip--

zm: 12379612
zw: 12451543
</code></pre><p>有错误信息和正确信息，因为有些统计指全球人口或者地区人口，这些是没有国别码的。现在我们先忽略它。</p>
<h2 id="制作世界地图"><a href="#制作世界地图" class="headerlink" title="制作世界地图"></a>制作世界地图</h2><p>我们跟着书做一个北美地图：<br><strong>americas.py</strong></p>
<hr>
<pre><code>import pygal_maps_world.maps

wm = pygal_maps_world.maps.World()
wm.title = &apos;North, Central, and South America&apos;

wm.add(&apos;North America&apos;, [&apos;ca&apos;, &apos;mx&apos;, &apos;us&apos;])
wm.add(&apos;Central America&apos;, [&apos;bz&apos;, &apos;cr&apos;, &apos;gt&apos;, &apos;hn&apos;, &apos;ni&apos;, &apos;pa&apos;, &apos;sv&apos;])
wm.add(&apos;South America&apos;, [&apos;ar&apos;, &apos;bo&apos;, &apos;br&apos;, &apos;cl&apos;, &apos;co&apos;, &apos;ec&apos;, &apos;gf&apos;,
    &apos;gy&apos;, &apos;pe&apos;, &apos;py&apos;, &apos;sr&apos;, &apos;uy&apos;, &apos;ve&apos;])

wm.render_to_file(&apos;americas.svg&apos;)
</code></pre><ul>
<li>使用方法 add()，它接受一个标签和一个列表，其中后者包含我们要突出的国家的国别码。每次调用 add() 都将为指定的国家选择一种新颜色，并在图表左边显示该颜色和指定的标签。</li>
<li>不过在这里，我们要以同一种颜色显示整个北美地区，因此第一次调用 add() 时，在传递给它的列表中包含 ‘ca’、 ‘mx’ 和 ‘us’，以同时突出加拿大、墨西哥和美国。</li>
</ul>
<p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/13.png"></p>
<h2 id="在世界地图上呈现数字数据"><a href="#在世界地图上呈现数字数据" class="headerlink" title="在世界地图上呈现数字数据"></a>在世界地图上呈现数字数据</h2><p><strong>na_populations.py</strong></p>
<hr>
<pre><code>import pygal_maps_world.maps

wm = pygal_maps_world.maps.World()
wm.title = &apos;Populations of Countries in North America&apos;
wm.add(&apos;North America&apos;, {&apos;ca&apos;: 34126000, &apos;us&apos;: 309349000, &apos;mx&apos;: 113423000})

wm.render_to_file(&apos;na_populations.svg&apos;)
</code></pre><ul>
<li>使用方法 add()，但这次通过第二个实参传递了一个字典而不是列表。</li>
<li>这个字典将两个字母的国别码作为键，将人口数量作为值。</li>
<li>Pygal 根据这些数字自动给不同国家着以深浅不一的颜色（人口最少的国家颜色最浅，人口最多的国家颜色最深）</li>
</ul>
<p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/14.png"></p>
<p>这幅地图具有交互性：如果你将鼠标指向某个国家，将看到其人口数量。下面在这个地图中添加更多的数据。</p>
<h2 id="绘制完整的世界人口地图"><a href="#绘制完整的世界人口地图" class="headerlink" title="绘制完整的世界人口地图"></a>绘制完整的世界人口地图</h2><p>把这个北美地图弄出来，世界地图也就不远了。<br>跳转到 <strong>world_population.py</strong>：</p>
<pre><code>import pygal_maps_world.maps

# 创建一个包含人口数量的字典
cc_populations = {}

--snip--

    code = get_country_code(country_name)
    if code:
        cc_populations[code] = population

wm = pygal_maps_world.maps.World()
wm.title = &apos;World Population in 2008, by Country&apos;
wm.add(&apos;2008&apos;, cc_populations)

wm.render_to_file(&apos;world_population.svg&apos;)
</code></pre><p>这里记得把之前的 print 语句删掉。</p>
<p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/15.png"></p>
<p>可以看到有些国家或地区没有统计到，这是因为上述没有国别码的原因造成的。现在先不管。</p>
<h2 id="根据人口数量将国家分组"><a href="#根据人口数量将国家分组" class="headerlink" title="根据人口数量将国家分组"></a>根据人口数量将国家分组</h2><p>看看地图，中国人口这么多，但是直观上看感觉好像没多到哪里去？为了突出这一点，我们将人口数量分成三组——少于 1000 万的、介于 1000 万和 10 亿之间的以及超过 10 亿的：</p>
<pre><code># 根据人口数量将所有的国家分成三组
cc_pops_1, cc_pops_2, cc_pops_3 = {}, {}, {}
for cc, pop in cc_populations.items():
    if pop &lt; 10000000:
        cc_pops_1[cc] = pop
    elif pop &lt; 1000000000:
        cc_pops_2[cc] = pop
    else:
        cc_pops_3[cc] = pop

# 看看每组分别包含多少个国家
print(len(cc_pops_1), len(cc_pops_2), len(cc_pops_3))

wm.title = &apos;World Population in 2008, by Country&apos;
wm.add(&apos;0-10m&apos;, cc_pops_1)
wm.add(&apos;10m-1bn&apos;, cc_pops_2)
wm.add(&apos;&gt;1bn&apos;, cc_pops_3)
</code></pre><p>运行后如下：<br>    85 69 2<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/16.png"></p>
<p>这样看起来就比较清晰了，但是我想让超过 10 亿人口的国家颜色为红色，怎么弄？</p>
<h2 id="使用-pygal-设置世界地图的样式"><a href="#使用-pygal-设置世界地图的样式" class="headerlink" title="使用 pygal 设置世界地图的样式"></a>使用 pygal 设置世界地图的样式</h2><pre><code>from pygal.style import RotateStyle

wm_style = RotateStyle(&apos;#336699&apos;)
wm = pygal_maps_world.maps.World(style=wm_style)
</code></pre><p>Pygal 样式存储在模块 style 中（这里注意下，不在 pygal_maps_world 库里面），我们从这个模块中导入了样式 RotateStyle ，这个实例需要一个实参——十六进制的 RGB 颜色。</p>
<p>十六进制格式的 RGB 颜色是一个以井号（#）打头的字符串，后面跟着6个字符，其中前两个字符表示红色分量，接下来的两个表示绿色分量，最后两个表示蓝色分量。每个分量<br>的取值范围为 00（没有相应的颜色）~FF（包含最多的相应颜色）。如果你在线搜索 hex color chooser （十六进制颜色选择器），可找到让你能够尝试选择不同的颜色并显示其 RGB 值的工具。</p>
<p>运行后如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-24-数据可视化（第二部分）/17.png"></p>
<h2 id="加亮颜色主题"><a href="#加亮颜色主题" class="headerlink" title="加亮颜色主题"></a>加亮颜色主题</h2><p>Pygal 通常默认使用较暗的颜色主题。有时候为了方便印刷，得使用 LightColorizedStyle 加亮地图的颜色。这个类修改整个图表的主题，包括背景色、标签以及各个国家的颜色。要使用这个样式，先导入它：</p>
<p><code>from pygal.style import LightColorizedStyle as LCS</code></p>
<p>然后就可独立地使用 LightColorizedStyle 了，例如：</p>
<p><code>wm_style = LCS</code></p>
<p>然而使用这个类时，你不能直接控制使用的颜色， Pygal 将选择默认的基色。要设置颜色，可使用 RotateStyle，并将 LightColorizedStyle 作为基本样式。</p>
<p>wm_style = RotateStyle(‘#336699’, base_style=LightColorizedStyle)</p>
<h1 id="学习要点"><a href="#学习要点" class="headerlink" title="学习要点"></a>学习要点</h1><ol>
<li>如何使用网上的数据集</li>
<li>如何处理CSV和JSON文件，以及如何提取你感兴趣的数据</li>
<li>如何使用 matplotlib 来处理以往的天气数据，包括如何使用模块 datetime，以及如何在同一个图表中绘制多个数据系列</li>
<li>如何使用 Pygal 绘制呈现各国数据的世界地图，以及如何设置 Pygal 地图和图表的样式</li>
</ol>
<h1 id="各部分源码"><a href="#各部分源码" class="headerlink" title="各部分源码"></a>各部分源码</h1><h2 id="highs-lows-py"><a href="#highs-lows-py" class="headerlink" title="highs_lows.py"></a>highs_lows.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import csv</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">from matplotlib import pyplot as plt</span><br><span class="line"></span><br><span class="line">filename = &apos;death_valley_2014.csv&apos;</span><br><span class="line">with open(filename) as f:</span><br><span class="line">	reader = csv.reader(f)</span><br><span class="line">	header_row = next(reader)</span><br><span class="line">	</span><br><span class="line">	for index, column_header in enumerate(header_row):</span><br><span class="line">		print(index, column_header)</span><br><span class="line">	</span><br><span class="line">	highs = []</span><br><span class="line">	dates = []</span><br><span class="line">	lows = []</span><br><span class="line">	for row in reader:</span><br><span class="line">		try:</span><br><span class="line">			current_date = datetime.strptime(row[0], &quot;%Y-%m-%d&quot;)</span><br><span class="line">			low = int(row[3])</span><br><span class="line">			high = int(row[1])</span><br><span class="line">		except ValueError:</span><br><span class="line">			print(current_date, &apos;missing data&apos;)</span><br><span class="line">		else:</span><br><span class="line">			lows.append(low)</span><br><span class="line">			dates.append(current_date)</span><br><span class="line">			highs.append(high)</span><br><span class="line">	</span><br><span class="line"># 根据数据绘制图形</span><br><span class="line">fig = plt.figure(dpi=128, figsize=(10, 6))</span><br><span class="line">plt.plot(dates, highs, c=&apos;red&apos;, alpha=0.5)</span><br><span class="line">plt.plot(dates, lows, c=&apos;blue&apos;, alpha=0.5)</span><br><span class="line">plt.fill_between(dates, highs, lows, facecolor=&apos;blue&apos;, alpha=0.1)</span><br><span class="line"></span><br><span class="line"># 设置图形的格式</span><br><span class="line">plt.title(&quot;Daily high and low temperatures - 2014&quot;, fontsize=24)</span><br><span class="line">plt.xlabel(&apos;&apos;, fontsize=16)</span><br><span class="line">fig.autofmt_xdate()</span><br><span class="line">plt.ylabel(&quot;Temperature (F)&quot;, fontsize=16)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<h2 id="world-population-py"><a href="#world-population-py" class="headerlink" title="world_population.py"></a>world_population.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import json</span><br><span class="line">import pygal_maps_world.maps</span><br><span class="line">import pygal</span><br><span class="line">from pygal.style import RotateStyle as RS, LightColorizedStyle as LCS</span><br><span class="line"></span><br><span class="line">from country_codes import get_country_code</span><br><span class="line"></span><br><span class="line"># 将数据加载到一个列表中</span><br><span class="line">filename = &apos;population_data.json&apos;</span><br><span class="line">with open (filename) as f:</span><br><span class="line">	pop_data = json.load(f)</span><br><span class="line">	</span><br><span class="line"># 创建一个包含人口数量的字典</span><br><span class="line">cc_populations = &#123;&#125;</span><br><span class="line"></span><br><span class="line"># 打印每个国家 2008 年的人口数量</span><br><span class="line">for pop_dict in pop_data:</span><br><span class="line">	if pop_dict[&apos;Year&apos;] == &apos;2008&apos;:</span><br><span class="line">		country_name = pop_dict[&apos;Country Name&apos;]</span><br><span class="line">		population = int(float(pop_dict[&apos;Value&apos;]))</span><br><span class="line">		code = get_country_code(country_name)</span><br><span class="line">		if code:</span><br><span class="line">			cc_populations[code] = population</span><br><span class="line"></span><br><span class="line"># 根据人口数量将所有的国家分成三组</span><br><span class="line">cc_pops_1, cc_pops_2, cc_pops_3 = &#123;&#125;, &#123;&#125;, &#123;&#125;</span><br><span class="line">for cc, pop in cc_populations.items():</span><br><span class="line">	if pop &lt; 10000000:</span><br><span class="line">		cc_pops_1[cc] = pop</span><br><span class="line">	elif pop &lt; 1000000000:</span><br><span class="line">		cc_pops_2[cc] = pop</span><br><span class="line">	else:</span><br><span class="line">		cc_pops_3[cc] = pop</span><br><span class="line"></span><br><span class="line"># 看看每组分别包含多少个国家</span><br><span class="line">print(len(cc_pops_1), len(cc_pops_2), len(cc_pops_3))</span><br><span class="line"></span><br><span class="line"># 自定义地图的颜色样式，并高亮颜色</span><br><span class="line">wm_style = RS(&apos;#336699&apos;, base_style=LCS)</span><br><span class="line">wm = pygal_maps_world.maps.World(style=wm_style)</span><br><span class="line">wm.title = &apos;World Population in 2008, by Country&apos;</span><br><span class="line">wm.add(&apos;0-10m&apos;, cc_pops_1)</span><br><span class="line">wm.add(&apos;10m-1bn&apos;, cc_pops_2)</span><br><span class="line">wm.add(&apos;&gt;1bn&apos;, cc_pops_3)</span><br><span class="line"></span><br><span class="line">wm.render_to_file(&apos;world_population.svg&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="country-codes-py"><a href="#country-codes-py" class="headerlink" title="country_codes.py"></a>country_codes.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pygal_maps_world.i18n import COUNTRIES</span><br><span class="line"></span><br><span class="line">def get_country_code(country_name):</span><br><span class="line">	&quot;&quot;&quot;根据指定的国家，返回 Pygal 使用的两个字母的国别码&quot;&quot;&quot;</span><br><span class="line">	for code, name in COUNTRIES.items():</span><br><span class="line">		if name == country_name:</span><br><span class="line">			return code</span><br><span class="line">	# 如果没有找到指定的国家，就返回 None</span><br><span class="line">	return None</span><br></pre></td></tr></table></figure>
<h2 id="americas-py"><a href="#americas-py" class="headerlink" title="americas.py"></a>americas.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import pygal_maps_world.maps</span><br><span class="line"></span><br><span class="line">wm = pygal_maps_world.maps.World()</span><br><span class="line">wm.title = &apos;North, Central, and South America&apos;</span><br><span class="line"></span><br><span class="line">wm.add(&apos;North America&apos;, [&apos;ca&apos;, &apos;mx&apos;, &apos;us&apos;])</span><br><span class="line">wm.add(&apos;Central America&apos;, [&apos;bz&apos;, &apos;cr&apos;, &apos;gt&apos;, &apos;hn&apos;, &apos;ni&apos;, &apos;pa&apos;, &apos;sv&apos;])</span><br><span class="line">wm.add(&apos;South America&apos;, [&apos;ar&apos;, &apos;bo&apos;, &apos;br&apos;, &apos;cl&apos;, &apos;co&apos;, &apos;ec&apos;, &apos;gf&apos;,</span><br><span class="line">	&apos;gy&apos;, &apos;pe&apos;, &apos;py&apos;, &apos;sr&apos;, &apos;uy&apos;, &apos;ve&apos;])</span><br><span class="line"></span><br><span class="line">wm.render_to_file(&apos;americas.svg&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="na-populations-py"><a href="#na-populations-py" class="headerlink" title="na_populations.py"></a>na_populations.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import pygal_maps_world.maps</span><br><span class="line"></span><br><span class="line">wm = pygal_maps_world.maps.World()</span><br><span class="line">wm.title = &apos;Populations of Countries in North America&apos;</span><br><span class="line">wm.add(&apos;North America&apos;, &#123;&apos;ca&apos;: 34126000, &apos;us&apos;: 309349000, &apos;mx&apos;: 113423000&#125;)</span><br><span class="line"></span><br><span class="line">wm.render_to_file(&apos;na_populations.svg&apos;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ganru.github.io/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ganru">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/ganru.github.io/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黑屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）.html" itemprop="url">数据可视化（第一部分）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-19T21:54:28+08:00">
                2018-10-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ganru.github.io/categories/Python笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Python笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>该笔记学习的内容均来自于《Python 编程：从入门到实践》，只是作为一个内容总纲，若需详细学习，可去百度网盘<a href="https://pan.baidu.com/share/init?surl=dFxjtXf" target="_blank" rel="noopener">下载</a> ，密码：7rup</p>
</blockquote>
<p>数据可视化指的是通过可视化表示来探索数据，它与数据挖掘紧密相关，而数据挖掘指的是使用代码来探索数据集的规律和关联。数据集可以是用一行代码就能表示的小型数字列表，也可以是数以几字节的数据。</p>
<blockquote>
<p><strong>项目简介：</strong></p>
<hr>
<p><em>基于随机漫步概念生成一个更有趣的数据集——根据一系列随机决策生成的图表。</em><br><em>通过使用</em> <em>Pygal，可在用户与图表交互时突出元素以及调整其大小，还可轻松地调整整个图表的尺寸，使其适合在微型智能手表或巨型显示器上显示。使用</em> <em>Pygal</em> <em>以各种方式探索掷骰子的结果。</em></p>
</blockquote>
<p>准备工作：</p>
<ol>
<li>安装 matplotlib 库<br>打开 cmd，用命令 <code>pip install matplotlib</code> 安装。</li>
<li>安装 pygal 库<br>打开 cmd，用命令 <code>pip install pygal</code> 安装。</li>
</ol>
<h1 id="绘制简单的折线图"><a href="#绘制简单的折线图" class="headerlink" title="绘制简单的折线图"></a>绘制简单的折线图</h1><p>安装好 matplotlib 库之后，我们简单的测试一下看看怎么用：<br><strong>mpl_squares.py</strong></p>
<hr>
<pre><code>import matplotlib.pyplot as plt

squares = [1, 4, 9, 16, 25]

plt.plot(squares)
plt.show()
</code></pre><p><code>plt.plot(squares)</code>：尝试根据这些数字绘制出有意义的图形<br><code>plt.show()</code>：打开matplotlib查看器，并显示绘制的图形<br>运行后如下图所示：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/1.png"></p>
<h2 id="标签文字与线条粗细的修改"><a href="#标签文字与线条粗细的修改" class="headerlink" title="标签文字与线条粗细的修改"></a>标签文字与线条粗细的修改</h2><p>有没有觉得上图字体太小？眼睛怕是要瞎了。</p>
<pre><code>import matplotlib.pyplot as plt

# 这一部分可视情况而添加，用于显示中文
from pylab import mpl  
mpl.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]


squares = [1, 4, 9, 16, 25]
plt.plot(squares, linewidth=5)

# 设置图表标题，并给坐标轴加上标签
plt.title(&quot;平方数列&quot;, fontsize=24)
plt.xlabel(&quot;值 &quot;, fontsize=14)
plt.ylabel(&quot;值的平方&quot;, fontsize=14)

# 设置刻度标记的大小
plt.tick_params(axis=&apos;both&apos;, labelsize=14)

plt.show()
</code></pre><p>运行后效果如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/2.jpg"></p>
<p><code>axis=&#39;both&#39;</code> 表示坐标刻度样式，<code>labelsize=14</code> 表示坐标刻度字体大小。</p>
<p>注意：<br>x 轴标签显示可能有问题，如果字体显示不完整，在字符结尾添加空格符。（可能是中文字符问题，英文字符无须如此操作）</p>
<h2 id="图形校正"><a href="#图形校正" class="headerlink" title="图形校正"></a>图形校正</h2><p>不知你们有没有注意到，4 的平方图像显示是 25。这是因为当我们向 plot() 提供一系列数字时，它假设第一个数据点对应的 x 坐标值为 0，但我们的第一个点对应的 x 值为 1。<br>为了改变这种行为，我们可以先加一些限定：</p>
<pre><code>import matplotlib.pyplot as plt

input_values = [1, 2, 3, 4, 5]
squares = [1, 4, 9, 16, 25]
plt.plot(input_values, squares, linewidth=5)

# 设置图表标题并给坐标轴加上标签
--snip--
</code></pre><p>给 plot() 同时提供输入值和输出值。</p>
<h2 id="使用-scatter-绘制散点图并设置其样式"><a href="#使用-scatter-绘制散点图并设置其样式" class="headerlink" title="使用 scatter() 绘制散点图并设置其样式"></a>使用 scatter() 绘制散点图并设置其样式</h2><p>有些数据可能不适合呈现出折线效果，像无规律离散视图，那么针对这种问题，我们可以用函数 scatter() 呈现。<br><strong>scatter_squares.py</strong></p>
<hr>
<pre><code>import matplotlib.pyplot as plt

plt.scatter(2, 4)
plt.show()
</code></pre><p>运行后效果如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/3.jpg"></p>
<p>图像有点无趣，加点功能：</p>
<pre><code>import matplotlib.pyplot as plt

from pylab import mpl  
mpl.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]

plt.scatter(2, 4, s=200)

# 设置图表标题并给坐标轴加上标签
plt.title(&quot;平方数列&quot;, fontsize=24)
plt.xlabel(&quot;值 &quot;, fontsize=14)
plt.ylabel(&quot;值的平方&quot;, fontsize=14)

# 设置刻度标记的大小
plt.tick_params(axis=&apos;both&apos;, which=&apos;major&apos;, labelsize=14)

plt.show()
</code></pre><p><code>plt.scatter(2, 4, s=200)</code>：使用实参 s 设置了绘制图形时使用的点的尺寸</p>
<p>运行后效果如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/4.jpg"></p>
<h2 id="用-scatter-进行多点绘制"><a href="#用-scatter-进行多点绘制" class="headerlink" title="用 scatter() 进行多点绘制"></a>用 scatter() 进行多点绘制</h2><p>知道怎么画点后，我们画多个点：</p>
<pre><code>from pylab import mpl  
mpl.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]

x_values = [1, 2, 3, 4, 5]
y_values = [1, 4, 9, 16, 25]

plt.scatter(x_values, y_values, s=100)

--snip--
</code></pre><p>运行后效果如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/5.jpg"></p>
<h2 id="自动计算数据"><a href="#自动计算数据" class="headerlink" title="自动计算数据"></a>自动计算数据</h2><p>现在知道怎么绘制离散点，但都是我们给定准确数值而画的，现在让 Python 自动计算数据：</p>
<pre><code>from pylab import mpl  
mpl.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]

x_values = list(range(1, 1001))
y_values = [x**2 for x in x_values]

plt.scatter(x_values, y_values, s=40)

# 设置每个坐标轴的取值范围
plt.axis([0, 1100, 0, 1100000])

--snip--
</code></pre><p>运行后效果如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/6.jpg"></p>
<p>有点怪怪的啊，好像生成了一条线？（点太多了哈哈）<br>函数 axis() 要求提供四个值： x 和 y 坐标轴的 <strong>最小值</strong> 和 <strong>最大值</strong>。</p>
<h2 id="删除数据点的轮廓"><a href="#删除数据点的轮廓" class="headerlink" title="删除数据点的轮廓"></a>删除数据点的轮廓</h2><p>仔细看上图，是否发现，这些大量的点粘连在一起，虽然组成了线段但是还是有点不光滑？<br>是因为 matplotlib 给散点图中的各个点指定颜色，默认为蓝色点和黑色轮廓，在散点图包含的数据点不多时效果很好，但是点多的话就不太好了。</p>
<p><code>plt.scatter(x_values, y_values, edgecolor=&#39;none&#39;, s=40)</code></p>
<p>加上 <code>edgecolor=&#39;none&#39;</code> 这个参数，就可以删除这些轮廓，使线段变得光滑。<strong>如果数据点不多就无需这么做了。</strong><br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/7.jpg"></p>
<h2 id="自定义颜色"><a href="#自定义颜色" class="headerlink" title="自定义颜色"></a>自定义颜色</h2><p>要修改数据点的颜色，可向 scatter() 传递参数 c，并将其设置为要使用的颜色的名称，如下：</p>
<p><code>plt.scatter(x_values, y_values, c=&#39;red&#39;, edgecolor=&#39;none&#39;, s=40)</code></p>
<p>当然，我们也还可以用 RGB 颜色模式自定义：</p>
<p><code>c=(0, 0, 0.8)</code></p>
<p>注意 c 的元组内各元素取值范围为 <strong>0 ~ 1</strong> 之间。分别表示 红色、绿色 和 蓝色 分量。值越接近 0，指定的颜色越深，值越接近 1，指定的颜色越浅。</p>
<h2 id="使用颜色映射"><a href="#使用颜色映射" class="headerlink" title="使用颜色映射"></a>使用颜色映射</h2><p>颜色映射（colormap）：是一系列颜色，它们从起始颜色渐变到结束颜色。在可视化中，颜色映射用于突出<strong>数据的规律</strong>，例如，你可能用较浅的颜色来显示较小的值，并使用较深的颜色来显示较大的值。</p>
<p><code>plt.scatter(x_values, y_values, c=y_values, cmap=plt.cm.Blues, edgecolor=&#39;none&#39;, s=40)</code></p>
<p>我们将参数 c 设置成了一个 y 值列表，并使用参数 cmap 告诉 pyplot 使用哪个颜色映射。<br>参数 cmap 要配合 c 使用，不然不知道怎么分配颜色。</p>
<img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/8.jpg">
<h2 id="自动保存图表"><a href="#自动保存图表" class="headerlink" title="自动保存图表"></a>自动保存图表</h2><p>绘制好图像后，如果想要保存图像，那么老是截图就不好玩了，将对 plt.show() 的调用替换为对 plt.savefig() 的调用：</p>
<p>将 <code>plt.show()</code> 替换为 <code>plt.savefig(&#39;squares_plot.png&#39;, bbox_inches=&#39;tight&#39;)</code></p>
<p>它会自动生成图像保存在 .py 文件所在目录中。第二个实参指定将图表多余的空白区域裁剪掉。</p>
<h1 id="随机漫步"><a href="#随机漫步" class="headerlink" title="随机漫步"></a>随机漫步</h1><p>随机漫步很有用处，比如我们抛硬币，正面出现多少次，反面出现多少次，全部由系统随机漫步生成，当然也远不仅如此。<br>我们模拟一下随机漫步的过程。</p>
<h2 id="创建-RandomWalk-类"><a href="#创建-RandomWalk-类" class="headerlink" title="创建 RandomWalk() 类"></a>创建 RandomWalk() 类</h2><p>创建 RandomWalk() 类，它随机选择前进的方向。这个类需要三个属性，其中一个是存储随机漫步次数的变量，其他两个是列表，分别存储随机漫步经过的每个点的 x 和 y 坐标。<br><strong>random_walk.py</strong></p>
<hr>
<pre><code>from random import choice

class RandomWalk():
    &quot;&quot;&quot;一个生成随机漫步的类&quot;&quot;&quot;

    def __init__(self, num_points=5000):
        &quot;&quot;&quot;初始化随机漫步的属性&quot;&quot;&quot;
        self.num_points = num_points

        # 所有随机漫步都始于（0，0）
        self.x_values = [0]
        self.y_values = [0]
</code></pre><p>每次做决策时都使用 choice() 来决定使用哪种选择。<br>漫步 5K 次，并设定漫步初始坐标。</p>
<h2 id="选择方向"><a href="#选择方向" class="headerlink" title="选择方向"></a>选择方向</h2><p>我们将使用 fill_walk() 来生成漫步包含的点，并决定每次漫步的方向，如下：</p>
<pre><code>def fill_walk(self):
    &quot;&quot;&quot;计算随机漫步包含的所有点&quot;&quot;&quot;

    # 不断漫步，直到达到指定的长度
    while len(self.x_values) &lt; self.num_points:

        # 决定前进方向以及沿这个方向前进的距离
        x_direction = choice([1, -1])
        x_distance = choice([0, 1, 2, 3, 4])
        x_step = x_direction * x_distance

        y_direction = choice([1, -1])
        y_distance = choice([0, 1, 2, 3, 4])
        y_step = y_direction * y_distance

        # 拒绝原地踏步
        if x_step == 0 and y_step == 0:
            continue

        # 计算下一个点的 x 、y 坐标 ([-1] 指列表最后一个元素)
        next_x = self.x_values[-1] + x_step
        next_y = self.y_values[-1] + y_step

        self.x_values.append(next_x)
        self.y_values.append(next_y)
</code></pre><h2 id="绘制随机漫步图"><a href="#绘制随机漫步图" class="headerlink" title="绘制随机漫步图"></a>绘制随机漫步图</h2><p><strong>rw_visual.py</strong></p>
<hr>
<pre><code>import matplotlib.pyplot as plt

from random_walk import RandomWalk

# 创建一个RandomWalk实例，并将其包含的点都绘制出来
rw = RandomWalk()
rw.fill_walk()
plt.scatter(rw.x_values, rw.y_values, s=15)
plt.show()
</code></pre><p>运行后效果如下：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/9.jpg"></p>
<p>不过刚开始运行的时候，可能会碰到这个问题：</p>
<p><code>SyntaxError: unexpected EOF while parsing</code></p>
<p>关掉在运行一遍即可，如果还有，那可能就是代码错误（eg：语法有问题、PY3 的代码在 PY2 中运行）</p>
<h2 id="模拟多次随机漫步"><a href="#模拟多次随机漫步" class="headerlink" title="模拟多次随机漫步"></a>模拟多次随机漫步</h2><p>如果我们想多次进行随机漫步，可以把这些代码加入 while 循环：</p>
<pre><code>while True：
    # 创建一个RandomWalk实例，并将其包含的点都绘制出来
    rw = RandomWalk()
    rw.fill_walk()
    plt.scatter(rw.x_values, rw.y_values, s=15)
    plt.show()

    keep_running = input(&quot;Make another walk? (y/n): &quot;)
    if keep_running == &apos;n&apos;:
        break
</code></pre><h2 id="设置随机漫步图的样式"><a href="#设置随机漫步图的样式" class="headerlink" title="设置随机漫步图的样式"></a>设置随机漫步图的样式</h2><p>我们定制图表，以突出每次漫步的重要特征，并让分散注意力的元素不那么显眼。为此，我们确定要突出的元素，如漫步的起点、终点和经过的路径。</p>
<h3 id="给点着色"><a href="#给点着色" class="headerlink" title="给点着色"></a>给点着色</h3><p>在这里，我们要删除每个点的黑色轮廓、让最近的漫步颜色渐深：</p>
<pre><code>while True:
# 创建一个RandomWalk实例，并将其包含的点都绘制出来
rw = RandomWalk()
rw.fill_walk()

point_numbers = list(range(rw.num_points))
plt.scatter(rw.x_values, rw.y_values, c=point_numbers, cmap=plt.cm.Blues, edgecolor=&apos;none&apos;, s=15)
</code></pre><p>运行后如下图所示：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/10.jpg"></p>
<h3 id="重新绘制起点与终点"><a href="#重新绘制起点与终点" class="headerlink" title="重新绘制起点与终点"></a>重新绘制起点与终点</h3><p>我们让起点和终点变得更大，并显示为不同的颜色，以突出它们：</p>
<pre><code># 突出起点和终点
plt.scatter(0, 0, c=&apos;green&apos;, edgecolors=&apos;none&apos;, s=100)
plt.scatter(rw.x_values[-1], rw.y_values[-1], c=&apos;red&apos;, edgecolors=&apos;none&apos;, s=100)
</code></pre><h3 id="隐藏坐标轴"><a href="#隐藏坐标轴" class="headerlink" title="隐藏坐标轴"></a>隐藏坐标轴</h3><p>为了让观察者注意力更好的放在路径上而不会分散一些注意力在坐标轴上，我们可以认为隐藏坐标轴：</p>
<pre><code># 隐藏坐标轴
plt.axes().get_xaxis().set_visible(False)
plt.axes().get_yaxis().set_visible(False)
</code></pre><p>运行后如下图所示：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/11.jpg"></p>
<h3 id="增加点数"><a href="#增加点数" class="headerlink" title="增加点数"></a>增加点数</h3><p>这次我们可以尝试将漫步次数加到 5W 次，不过记得让点的尺寸 (s) 变小一点。</p>
<h3 id="调整窗口尺寸"><a href="#调整窗口尺寸" class="headerlink" title="调整窗口尺寸"></a>调整窗口尺寸</h3><pre><code># 设置绘图窗口的尺寸
plt.figure(dpi=128, figsize=(10, 6))
</code></pre><ol>
<li>函数figure()用于指定图表的宽度、高度、分辨率和背景色。单位为 英寸。</li>
<li>Python 假定屏幕分辨率为 80 像素/英寸，如果上述代码指定的图表尺寸不合适，可根据需要调整其中的数字。</li>
<li>如果你知道自己的系统的分辨率，可使用形参 dpi 向 figure() 传递该分辨率（书中原话，不过我试验的时候用 1080 ，崩了，所以还是建议别传这么大的值）</li>
</ol>
<h3 id="代码重构"><a href="#代码重构" class="headerlink" title="代码重构"></a>代码重构</h3><p>有没有感觉 fill_walk() 有点长？试试重构？</p>
<pre><code>def fill_walk(self):
    &quot;&quot;&quot;计算随机漫步包含的所有点&quot;&quot;&quot;

    # 不断漫步，直到达到指定的长度
    while len(self.x_values) &lt; self.num_points:

        # 决定前进方向以及沿这个方向前进的距离
        x_step = self.get_step()
        y_step = self.get_step()

        # 拒绝原地踏步
        if x_step == 0 and y_step == 0:
            continue

        # 计算下一个点的 x 、y 坐标 ([-1] 指列表最后一个元素)
        next_x = self.x_values[-1] + x_step
        next_y = self.y_values[-1] + y_step

        self.x_values.append(next_x)
        self.y_values.append(next_y)

def get_step(self):
    &quot;&quot;&quot;计算下一个点的可能前进距离&quot;&quot;&quot;
    direction = choice([1, -1])
    distance = choice([0, 1, 2, 3, 4])
    step = direction * distance
    return step
</code></pre><h1 id="使用-Pygal-模拟掷骰子"><a href="#使用-Pygal-模拟掷骰子" class="headerlink" title="使用 Pygal 模拟掷骰子"></a>使用 Pygal 模拟掷骰子</h1><p>我们将使用 Python 可视化包 Pygal 来生成可缩放的矢量图形文件。对于需要在尺寸不同的屏幕上显示的图表，这很有用，因为它们将自动缩放，以适合观看者的屏幕。</p>
<p>在此之前我们要先安装 Pygal 库：</p>
<p><code>pip install pygal</code></p>
<h2 id="创建-Die-类"><a href="#创建-Die-类" class="headerlink" title="创建 Die 类"></a>创建 Die 类</h2><p><strong>die.py</strong></p>
<hr>
<pre><code>from random import randint

class Die():
    &quot;&quot;&quot;表示一个骰子的类&quot;&quot;&quot;

    def __init__(self, num_sides=6):
        &quot;&quot;&quot;骰子有几面，不导入实参就默认六面&quot;&quot;&quot;
        self.num_sides = num_sides

    def roll(self):
        &quot;&quot;&quot;返回一个位于1和骰子面数之间的随机值&quot;&quot;&quot;
        return randint(1, self.num_sides)
</code></pre><p>函数 randint() 来返回一个 1 和面数之间的随机数。</p>
<h2 id="掷骰子"><a href="#掷骰子" class="headerlink" title="掷骰子"></a>掷骰子</h2><p><strong>die_visual.py</strong></p>
<hr>
<pre><code>from die import Die

# 创建一个D6
die = Die()

# 掷几次骰子，并将结果存储在一个列表中
results = []
for roll_num in range(1000):
    result = die.roll()
    results.append(result)

print(results)
</code></pre><p>检验一下，输出大概没问题（有 1、6 也有 1 ~ 6 之间的数，没有其他数）</p>
<h2 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h2><p>为分析掷一个D6骰子的结果，我们计算每个点数出现的次数：</p>
<pre><code># 分析结果
frequencies = []
for value in range(1, die.num_sides+1):
    frequency = results.count(value)
    frequencies.append(frequency)

print(frequencies)
</code></pre><p>会看到这样的结果：</p>
<pre><code>[173, 161, 165, 181, 158, 162]
</code></pre><p>很合理，并没有哪个点超出某个点很多。接下来我们可视化这些数据。</p>
<h2 id="绘制直方图"><a href="#绘制直方图" class="headerlink" title="绘制直方图"></a>绘制直方图</h2><p>有了上面提供的频率列表，绘制直方图就比较容易了。</p>
<pre><code># 对结果进行可视化成条形图
hist = pygal.Bar()

hist.title = &quot;Results of rolling one D6 1000 times.&quot;
hist.x_labels = [&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;]
hist.x_title = &quot;Results&quot;
hist.y_title = &quot;Frequency of Result&quot;

# 添加数据， 第一个参数是数据的标题
hist.add(&apos;D6&apos;, frequencies)
# 保存到本地，格式必须是 svg
hist.render_to_file(&apos;die_visual.svg&apos;)
</code></pre><h2 id="同时掷两个骰子"><a href="#同时掷两个骰子" class="headerlink" title="同时掷两个骰子"></a>同时掷两个骰子</h2><p>做两个骰子试下，，并将这两个得到的数值相加：</p>
<pre><code># 创建两个D6骰子
die_1 = Die()
die_2 = Die()
</code></pre><p>不过这样子得改动一下，毕竟最小值是 2，最大 12：</p>
<pre><code># 掷几次骰子，并将结果存储在一个列表中
results = []
for roll_num in range(1000):
    result = die_1.roll() + die_2.roll()
    results.append(result)

# 分析结果
frequencies = []
max_result = die_1.num_sides + die_2.num_sides
# 这里尽量别写 range(2, 13)，我们要保证代码可适用于更多不同的面
for value in range(2, max_result+1):
    frequency = results.count(value)
    frequencies.append(frequency)

# 对结果进行可视化
hist = pygal.Bar()

hist.title = &quot;Results of rolling two D6 dice 1000 times.&quot;
hist.x_labels = [&apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;, &apos;10&apos;, &apos;11&apos;, &apos;12&apos;]
hist.x_title = &quot;Results&quot;
hist.y_title = &quot;Frequency of Result&quot;

hist.add(&apos;D6 + D6&apos;, frequencies)
</code></pre><p>运行后如下图所示：<br><img src="/ganru.github.io/posts/Python笔记/2018-10-19-数据可视化（第一部分）/12.jpg"></p>
<h2 id="多面骰子"><a href="#多面骰子" class="headerlink" title="多面骰子"></a>多面骰子</h2><p><code>die_2 = Die(10)</code> 这样子试试？</p>
<h1 id="学习要点"><a href="#学习要点" class="headerlink" title="学习要点"></a>学习要点</h1><ol>
<li>如何生成数据集以及如何对其进行可视化</li>
<li>折线图的绘制 <em>plt.plot()</em></li>
<li>散点图的绘制 <em>plt.scatter()</em></li>
<li>用随机漫步数据绘制散点图</li>
<li>直方图的绘制 <em>pygal.Bar()</em></li>
</ol>
<h1 id="各组件源码"><a href="#各组件源码" class="headerlink" title="各组件源码"></a>各组件源码</h1><h2 id="mpl-squares-py"><a href="#mpl-squares-py" class="headerlink" title="mpl_squares.py"></a>mpl_squares.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">from pylab import mpl  </span><br><span class="line">mpl.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]</span><br><span class="line"></span><br><span class="line">input_values = [1, 2, 3, 4, 5]</span><br><span class="line">squares = [1, 4, 9, 16, 25]</span><br><span class="line">plt.plot(input_values, squares, linewidth=5)</span><br><span class="line"></span><br><span class="line"># 设置图表标题，并给坐标轴加上标签</span><br><span class="line">plt.title(&quot;平方数列&quot;, fontsize=24)</span><br><span class="line">plt.xlabel(&quot;值 &quot;, fontsize=14)</span><br><span class="line">plt.ylabel(&quot;值的平方&quot;, fontsize=14)</span><br><span class="line"></span><br><span class="line"># 设置刻度标记的大小</span><br><span class="line">plt.tick_params(axis=&apos;both&apos;, labelsize=14)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<h2 id="scatter-squares-py"><a href="#scatter-squares-py" class="headerlink" title="scatter_squares.py"></a>scatter_squares.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">from pylab import mpl  </span><br><span class="line">mpl.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]</span><br><span class="line"></span><br><span class="line">x_values = list(range(1, 1001))</span><br><span class="line">y_values = [x**2 for x in x_values]</span><br><span class="line"></span><br><span class="line">plt.scatter(x_values, y_values, c=y_values, cmap=plt.cm.Blues, edgecolor=&apos;none&apos;, s=40)</span><br><span class="line"></span><br><span class="line"># 设置图表标题并给坐标轴加上标签</span><br><span class="line">plt.title(&quot;平方数列&quot;, fontsize=24)</span><br><span class="line">plt.xlabel(&quot;值 &quot;, fontsize=14)</span><br><span class="line">plt.ylabel(&quot;值的平方&quot;, fontsize=14)</span><br><span class="line"></span><br><span class="line"># 设置刻度标记的大小</span><br><span class="line">plt.tick_params(axis=&apos;both&apos;, which=&apos;major&apos;, labelsize=14)</span><br><span class="line"></span><br><span class="line"># 设置每个坐标轴的取值范围</span><br><span class="line">plt.axis([0, 1100, 0, 1100000])</span><br><span class="line"></span><br><span class="line">plt.savefig(&apos;squares_plot.png&apos;, bbox_inches=&apos;tight&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="random-walk-py"><a href="#random-walk-py" class="headerlink" title="random_walk.py"></a>random_walk.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">from random import choice</span><br><span class="line"></span><br><span class="line">class RandomWalk():</span><br><span class="line">	&quot;&quot;&quot;一个生成随机漫步的类&quot;&quot;&quot;</span><br><span class="line">	</span><br><span class="line">	def __init__(self, num_points=50000):</span><br><span class="line">		&quot;&quot;&quot;初始化随机漫步的属性&quot;&quot;&quot;</span><br><span class="line">		self.num_points = num_points</span><br><span class="line">		</span><br><span class="line">		# 所有随机漫步都始于（0，0）</span><br><span class="line">		self.x_values = [0]</span><br><span class="line">		self.y_values = [0]</span><br><span class="line">		</span><br><span class="line">	def fill_walk(self):</span><br><span class="line">		&quot;&quot;&quot;计算随机漫步包含的所有点&quot;&quot;&quot;</span><br><span class="line">		</span><br><span class="line">		# 不断漫步，直到达到指定的长度</span><br><span class="line">		while len(self.x_values) &lt; self.num_points:</span><br><span class="line">			</span><br><span class="line">			# 决定前进方向以及沿这个方向前进的距离</span><br><span class="line">			x_step = self.get_step()</span><br><span class="line">			y_step = self.get_step()</span><br><span class="line">			</span><br><span class="line">			# 拒绝原地踏步</span><br><span class="line">			if x_step == 0 and y_step == 0:</span><br><span class="line">				continue</span><br><span class="line">			</span><br><span class="line">			# 计算下一个点的 x 、y 坐标 ([-1] 指列表最后一个元素)</span><br><span class="line">			next_x = self.x_values[-1] + x_step</span><br><span class="line">			next_y = self.y_values[-1] + y_step</span><br><span class="line">			</span><br><span class="line">			self.x_values.append(next_x)</span><br><span class="line">			self.y_values.append(next_y)</span><br><span class="line">		</span><br><span class="line">	def get_step(self):</span><br><span class="line">		&quot;&quot;&quot;计算下一个点的可能前进距离&quot;&quot;&quot;</span><br><span class="line">		direction = choice([1, -1])</span><br><span class="line">		distance = choice([0, 1, 2, 3, 4])</span><br><span class="line">		step = direction * distance</span><br><span class="line">		return step</span><br></pre></td></tr></table></figure>
<h2 id="rw-visual-py"><a href="#rw-visual-py" class="headerlink" title="rw_visual.py"></a>rw_visual.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">from random_walk import RandomWalk</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">	# 创建一个RandomWalk实例，并将其包含的点都绘制出来</span><br><span class="line">	rw = RandomWalk()</span><br><span class="line">	rw.fill_walk()</span><br><span class="line">	</span><br><span class="line">	# 设置绘图窗口的尺寸</span><br><span class="line">	plt.figure(dpi=256, figsize=(10, 6))</span><br><span class="line">	</span><br><span class="line">	point_numbers = list(range(rw.num_points))</span><br><span class="line">	plt.scatter(rw.x_values, rw.y_values, c=point_numbers, cmap=plt.cm.Blues, edgecolor=&apos;none&apos;, s=1)</span><br><span class="line">	</span><br><span class="line">	# 突出起点和终点</span><br><span class="line">	plt.scatter(0, 0, c=&apos;green&apos;, edgecolors=&apos;none&apos;, s=10)</span><br><span class="line">	plt.scatter(rw.x_values[-1], rw.y_values[-1], c=&apos;red&apos;, edgecolors=&apos;none&apos;, s=10)</span><br><span class="line">	</span><br><span class="line">	# 隐藏坐标轴</span><br><span class="line">	plt.axes().get_xaxis().set_visible(False)</span><br><span class="line">	plt.axes().get_yaxis().set_visible(False)</span><br><span class="line">	</span><br><span class="line">	plt.show()</span><br><span class="line"></span><br><span class="line">	keep_running = input(&quot;Make another walk? (y/n): &quot;)</span><br><span class="line">	if keep_running == &apos;n&apos;:</span><br><span class="line">		break</span><br></pre></td></tr></table></figure>
<h2 id="die-py"><a href="#die-py" class="headerlink" title="die.py"></a>die.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from random import randint</span><br><span class="line"></span><br><span class="line">class Die():</span><br><span class="line">	&quot;&quot;&quot;表示一个骰子的类&quot;&quot;&quot;</span><br><span class="line">	</span><br><span class="line">	def __init__(self, num_sides=6):</span><br><span class="line">		&quot;&quot;&quot;骰子有几面，不导入实参就默认六面&quot;&quot;&quot;</span><br><span class="line">		self.num_sides = num_sides</span><br><span class="line">		</span><br><span class="line">	def roll(self):</span><br><span class="line">		&quot;&quot;&quot;返回一个位于 1 和骰子面数之间的随机值&quot;&quot;&quot;</span><br><span class="line">		return randint(1, self.num_sides)</span><br></pre></td></tr></table></figure>
<h2 id="die-visual-py"><a href="#die-visual-py" class="headerlink" title="die_visual.py"></a>die_visual.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import pygal</span><br><span class="line"></span><br><span class="line">from die import Die</span><br><span class="line">from pylab import mpl  </span><br><span class="line">mpl.rcParams[&apos;font.sans-serif&apos;] = [&apos;SimHei&apos;]</span><br><span class="line"></span><br><span class="line"># 创建两个D6骰子</span><br><span class="line">die_1 = Die()</span><br><span class="line">die_2 = Die()</span><br><span class="line"></span><br><span class="line"># 掷几次骰子，并将结果存储在一个列表中</span><br><span class="line">results = []</span><br><span class="line">for roll_num in range(1000):</span><br><span class="line">	result = die_1.roll() + die_2.roll()</span><br><span class="line">	results.append(result)</span><br><span class="line"></span><br><span class="line"># 分析结果</span><br><span class="line">frequencies = []</span><br><span class="line">max_result = die_1.num_sides + die_2.num_sides</span><br><span class="line">for value in range(2, max_result+1):</span><br><span class="line">	frequency = results.count(value)</span><br><span class="line">	frequencies.append(frequency)</span><br><span class="line">	</span><br><span class="line"># 对结果进行可视化</span><br><span class="line">hist = pygal.Bar()</span><br><span class="line"></span><br><span class="line">hist.title = &quot;Results of rolling two D6 dice 1000 times.&quot;</span><br><span class="line">hist.x_labels = [&apos;2&apos;, &apos;3&apos;, &apos;4&apos;, &apos;5&apos;, &apos;6&apos;, &apos;7&apos;, &apos;8&apos;, &apos;9&apos;, &apos;10&apos;, &apos;11&apos;, &apos;12&apos;]</span><br><span class="line">hist.x_title = &quot;Results&quot;</span><br><span class="line">hist.y_title = &quot;Frequency of Result&quot;</span><br><span class="line"></span><br><span class="line">hist.add(&apos;D6 + D6&apos;, frequencies)</span><br><span class="line">hist.render_to_file(&apos;die_visual.svg&apos;)</span><br><span class="line"></span><br><span class="line">print(frequencies)</span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ganru.github.io/ganru.github.io/posts/Python笔记/2018-10-14-python-引发异常-raise-及处理.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ganru">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/ganru.github.io/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黑屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/ganru.github.io/posts/Python笔记/2018-10-14-python-引发异常-raise-及处理.html" itemprop="url">python 引发异常 raise() 及处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-14T16:37:31+08:00">
                2018-10-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ganru.github.io/categories/Python笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Python笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们要学习异常语句处理，比如在自写函数中引入异常报警机制、用户使用程序时友好的提出异常错误等等。</p>
<blockquote>
<p>用 raise 语句来引发一个异常。异常/错误对象必须有一个名字，且它们应是 <strong>Error</strong> 或<strong> Exception </strong>类的子类。</p>
<blockquote>
<p>Python用异常对象 (exception object) 表示异常情况，遇到错误后，会引发异常。如果异常对象并未被处理或捕捉，程序就会用所谓的回溯 (Traceback,一种错误信息) 终止执行。</p>
</blockquote>
</blockquote>
<h1 id="raise-语句格式"><a href="#raise-语句格式" class="headerlink" title="raise() 语句格式"></a>raise() 语句格式</h1><p>Python 中的 raise 关键字用于引发一个异常，基本上和 Java 中的 throw 关键字相同，如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def Err():</span><br><span class="line">    raise Exception(&quot;抛出一个异常&quot;) </span><br><span class="line"># Exception: 抛出一个异常 </span><br><span class="line">Err()</span><br></pre></td></tr></table></figure></p>
<p>raise 关键字后面是抛出是一个通用的异常类型 (Exception)，一般来说抛出的异常越详细越好，Python 在 exceptions 模块内建了很多的异常类型。</p>
<h1 id="传递异常"><a href="#传递异常" class="headerlink" title="传递异常"></a>传递异常</h1><p>捕捉到了异常，但是又想重新引发它(传递异常)，可以使用不带参数的raise语句即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">	answer = int(first_number) / int(second_number)</span><br><span class="line">except ZeroDivisionError:</span><br><span class="line">	raise</span><br></pre></td></tr></table></figure></p>
<h1 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h1><p>Python 中也可以自定义自己的特殊类型的异常，只需要要从 Exception 类继承(直接或间接)即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class err(Exception):</span><br><span class="line">	pass</span><br></pre></td></tr></table></figure></p>
<h1 id="捕捉异常"><a href="#捕捉异常" class="headerlink" title="捕捉异常"></a>捕捉异常</h1><h2 id="捕捉一个异常"><a href="#捕捉一个异常" class="headerlink" title="捕捉一个异常"></a>捕捉一个异常</h2><p>Python 中使用 try/except 关键字来捕捉异常，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">	print(5/0)</span><br><span class="line">except ZeroDivisionError:</span><br><span class="line">	print(&quot;You can&apos;t divide by 0!&quot;)</span><br></pre></td></tr></table></figure></p>
<h2 id="捕捉多个异常"><a href="#捕捉多个异常" class="headerlink" title="捕捉多个异常"></a>捕捉多个异常</h2><p>在一个 except 语句只捕捉其后声明的异常类型，如果可能会抛出的是其他类型的异常就需要再增加一个 except 语句了，或者也可以指定一个更通用的异常类型比如：Exception，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">	print(5/0)</span><br><span class="line">except ZeroDivisionError:</span><br><span class="line">	print(&quot;You can&apos;t divide by 0!&quot;)</span><br><span class="line">except Exception:</span><br><span class="line">	print(&apos;其他类型异常&apos;)</span><br></pre></td></tr></table></figure></p>
<h1 id="获取异常信息"><a href="#获取异常信息" class="headerlink" title="获取异常信息"></a>获取异常信息</h1><p>有时候引发了异常，但是我们需要记录这段异常信息，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">	print(5/0)</span><br><span class="line">except (ZeroDivisionError, Exception) as err:</span><br><span class="line">	print (err)</span><br></pre></td></tr></table></figure></p>
<h1 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h1><p>finally 语句有点不同，它跟 try 语句相对独立：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    print(5/0)</span><br><span class="line">except (ZeroDivisionError, Exception):</span><br><span class="line">    print (&apos;发生了一个异常&apos;)</span><br><span class="line">finally:</span><br><span class="line">    print(&apos;不管是否发生异常都执行&apos;)</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ganru.github.io/ganru.github.io/posts/Python笔记/2018-10-13-python-之装饰器解析.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ganru">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/ganru.github.io/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黑屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/ganru.github.io/posts/Python笔记/2018-10-13-python-之装饰器解析.html" itemprop="url">python 之装饰器解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-13T16:36:15+08:00">
                2018-10-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ganru.github.io/categories/Python笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Python笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>装饰器很绕人，话不多说，先看代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">def outer1(func):</span><br><span class="line">	def inner(*args,**kwargs):</span><br><span class="line">		print(&quot;认证成功！&quot;)</span><br><span class="line">		result = func(*args,**kwargs)</span><br><span class="line">		print(&quot;日志添加成功&quot;)</span><br><span class="line">		return result</span><br><span class="line">	return inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def outer2(func):</span><br><span class="line">	def inner(*args,**kwargs):</span><br><span class="line">		print(&quot;一条欢迎信息。。。&quot;)</span><br><span class="line">		result = func(*args,**kwargs)</span><br><span class="line">		print(&quot;一条欢送信息。。。&quot;)</span><br><span class="line">		return result</span><br><span class="line">	return inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@outer1</span><br><span class="line">@outer2</span><br><span class="line">def f1(name,age):</span><br><span class="line">	print(&quot;%s 正在连接业务部门1数据接口......&quot;%name)</span><br><span class="line"></span><br><span class="line"># 调用方法</span><br><span class="line">f1(&quot;jack&quot;,18)</span><br><span class="line"></span><br><span class="line">#--------------------------------------------------</span><br><span class="line">执行结果：</span><br><span class="line"></span><br><span class="line">认证成功！</span><br><span class="line">一条欢迎信息。。。</span><br><span class="line">jack 正在连接业务部门1数据接口......</span><br><span class="line">一条欢送信息。。。</span><br><span class="line">日志添加成功</span><br></pre></td></tr></table></figure></p>
<p>看到两个 @ 了吗？<br>@ 的作用是将下面出现的函数 (f1) 作为参数传递给 @ 中的函数 (other2) ，并根据它的返回值给 f1 赋值</p>
<ol>
<li>读取 @outer1 ，此时 outer2 函数名变更为 outer1 中的 inner</li>
<li>读取 @outer2 ，此时 f1 函数名变更为 outer2 中的 inner</li>
<li>多重装饰器<strong>读取</strong>的时候自上而下，<strong>执行</strong>的时候自下而上</li>
<li>每次看到这类型的装饰器调用，比如这个，不妨先将他们等效于另一种语句，比如：<br><code>f1 = outer1(outer2(f1))(&quot;jack&quot;,18)</code> 方便理解</li>
<li>装饰器存在的目的，是为了在不改变（或者说无权改变）调用函数 f1() 的情况下，添加一些细节，比如上述的 认证成功！日志添加成功 这种</li>
<li>@ 修饰符在声明时就完成了函数名的转换</li>
</ol>
<p>此外，还有一种情况，就是装饰器带参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 认证函数</span><br><span class="line">def  auth(request,kargs):</span><br><span class="line">    print(&quot;认证成功！&quot;)</span><br><span class="line"></span><br><span class="line"># 日志函数</span><br><span class="line">def log(request,kargs):</span><br><span class="line">    print(&quot;日志添加成功&quot;)</span><br><span class="line"></span><br><span class="line"># 装饰器函数。接收两个参数，这两个参数应该是某个函数的名字。</span><br><span class="line">def Filter(auth_func,log_func):</span><br><span class="line">    # 第一层封装，f1 函数实际上被传递给了 main_fuc 这个参数</span><br><span class="line">    def outer(main_func):</span><br><span class="line">        # 第二层封装，auth 和 log 函数的参数值被传递到了这里</span><br><span class="line">        def wrapper(request,kargs):</span><br><span class="line">            # 下面代码的判断逻辑不重要，重要的是参数的引用和返回值</span><br><span class="line">            before_result = auth(request,kargs)</span><br><span class="line">            if(before_result != None):</span><br><span class="line">                return before_result;</span><br><span class="line"></span><br><span class="line">            main_result = main_func(request,kargs)</span><br><span class="line">            if(main_result != None):</span><br><span class="line">                return main_result;</span><br><span class="line"></span><br><span class="line">            after_result = log(request,kargs)</span><br><span class="line">            if(after_result != None):</span><br><span class="line">                return after_result;</span><br><span class="line"></span><br><span class="line">        return wrapper</span><br><span class="line">    return outer</span><br><span class="line"># 注意了，这里的装饰器函数有参数哦，它的意思是先执行 filter 函数</span><br><span class="line"># 然后将 filter 函数的返回值作为装饰器函数的名字返回到这里，所以，</span><br><span class="line"># 其实这里，Filter(auth,log) = outer , @Filter(auth,log) =  @outer</span><br><span class="line">@Filter(auth,log)</span><br><span class="line">def f1(name,age):</span><br><span class="line"></span><br><span class="line">    print(&quot;%s 正在连接业务部门1数据接口......&quot;%name)</span><br><span class="line"></span><br><span class="line"># 调用方法</span><br><span class="line">f1(&quot;jack&quot;,18)</span><br><span class="line"></span><br><span class="line">#-----------------------------------------------</span><br><span class="line">运行结果：</span><br><span class="line"></span><br><span class="line">认证成功！</span><br><span class="line">jack 正在连接业务部门1数据接口......</span><br><span class="line">日志添加成功</span><br></pre></td></tr></table></figure>
<p>装饰器带参数就成了装饰器函数，这时候要先把它转换成它返回的函数：</p>
<p><code>@Filter(auth,log) =  @outer</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/ganru.github.io/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/ganru.github.io/">1</a><span class="page-number current">2</span><a class="page-number" href="/ganru.github.io/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/ganru.github.io/page/5/">5</a><a class="extend next" rel="next" href="/ganru.github.io/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/ganru.github.io/images/avatar.png"
                alt="Ganru" />
            
              <p class="site-author-name" itemprop="name">Ganru</p>
              <p class="site-description motion-element" itemprop="description">学习一向都是孤独的，慢慢玩。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/ganru.github.io/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ganru" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ganr1988@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ganru</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/ganru.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/ganru.github.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/ganru.github.io/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/ganru.github.io/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/ganru.github.io/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/ganru.github.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
