<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/ganru.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/ganru.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/ganru.github.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/ganru.github.io/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/ganru.github.io/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/ganru.github.io/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/ganru.github.io/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="学习笔记," />










<meta name="description" content="写在前面   该笔记学习的内容均来自于《Python 编程：从入门到实践》，只是作为一个内容总纲，若需详细学习，可去百度网盘下载 ，密码：7rup  拟作一个小游戏项目：外星人入侵  游戏简介：  在游戏《外星人入侵》中，玩家控制着一艘最初出现在屏幕底部中央的飞船。玩家可以使用箭头键左右移动飞船，还可使用空格键进行射击。游戏开始时，一群外星人出现在天空中，他们在屏幕中向下移动。玩家的任务是射杀这些">
<meta name="keywords" content="学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="小游戏之外星人入侵（第一部分）">
<meta property="og:url" content="https://ganru.github.io/posts/Python笔记/2018-10-02-小游戏之外星人入侵（第一部分）.html">
<meta property="og:site_name" content="小黑屋">
<meta property="og:description" content="写在前面   该笔记学习的内容均来自于《Python 编程：从入门到实践》，只是作为一个内容总纲，若需详细学习，可去百度网盘下载 ，密码：7rup  拟作一个小游戏项目：外星人入侵  游戏简介：  在游戏《外星人入侵》中，玩家控制着一艘最初出现在屏幕底部中央的飞船。玩家可以使用箭头键左右移动飞船，还可使用空格键进行射击。游戏开始时，一群外星人出现在天空中，他们在屏幕中向下移动。玩家的任务是射杀这些">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-10-10T15:25:24.315Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小游戏之外星人入侵（第一部分）">
<meta name="twitter:description" content="写在前面   该笔记学习的内容均来自于《Python 编程：从入门到实践》，只是作为一个内容总纲，若需详细学习，可去百度网盘下载 ，密码：7rup  拟作一个小游戏项目：外星人入侵  游戏简介：  在游戏《外星人入侵》中，玩家控制着一艘最初出现在屏幕底部中央的飞船。玩家可以使用箭头键左右移动飞船，还可使用空格键进行射击。游戏开始时，一群外星人出现在天空中，他们在屏幕中向下移动。玩家的任务是射杀这些">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/ganru.github.io/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ganru.github.io/posts/Python笔记/2018-10-02-小游戏之外星人入侵（第一部分）.html"/>





  <title>小游戏之外星人入侵（第一部分） | 小黑屋</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/ganru.github.io/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小黑屋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/ganru.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/ganru.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-essay">
          <a href="/ganru.github.io/categories/随笔" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-terminal"></i> <br />
            
            随笔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-write">
          <a href="/ganru.github.io/categories/写作" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-edit"></i> <br />
            
            写作
          </a>
        </li>
      
        
        <li class="menu-item menu-item-read">
          <a href="/ganru.github.io/categories/阅读" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            阅读
          </a>
        </li>
      
        
        <li class="menu-item menu-item-study">
          <a href="/ganru.github.io/categories/学习" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-bookmark"></i> <br />
            
            学习
          </a>
        </li>
      
        
        <li class="menu-item menu-item-java">
          <a href="/ganru.github.io/categories/Java" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-coffee"></i> <br />
            
            Java
          </a>
        </li>
      
        
        <li class="menu-item menu-item-py_code">
          <a href="/ganru.github.io/categories/Python笔记" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-codiepie"></i> <br />
            
            Python
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ganru.github.io/ganru.github.io/posts/Python笔记/2018-10-02-小游戏之外星人入侵（第一部分）.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ganru">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/ganru.github.io/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小黑屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">小游戏之外星人入侵（第一部分）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-02T23:56:53+08:00">
                2018-10-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ganru.github.io/categories/Python笔记/" itemprop="url" rel="index">
                    <span itemprop="name">Python笔记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><strong><p>写在前面</p></strong></p>
<hr>
<blockquote>
<p>该笔记学习的内容均来自于《Python 编程：从入门到实践》，只是作为一个内容总纲，若需详细学习，可去百度网盘<a href="https://pan.baidu.com/share/init?surl=dFxjtXf" target="_blank" rel="noopener">下载</a> ，密码：7rup</p>
</blockquote>
<p>拟作一个小游戏项目：<strong>外星人入侵</strong></p>
<blockquote>
<p><em>游戏简介：</em><br>  <em>在游戏《外星人入侵》中，玩家控制着一艘最初出现在屏幕底部中央的飞船。玩家可以使用箭头键左右移动飞船，还可使用空格键进行射击。游戏开始时，一群外星人出现在天空中，他们在屏幕中向下移动。玩家的任务是射杀这些外星人。玩家将所有外星人都消灭干净后，将出现一群新的外星人，他们移动的速度更快。只要有外星人撞到了玩家的飞船或到达了屏幕底部，玩家就损失一艘飞船。玩家损失三艘飞船后，游戏结束。</em></p>
</blockquote>
<p>准备工作：</p>
<ol>
<li>安装 Pygame 模块：打开 cmd ，输入指令：pip install pygame (若出错输入 pip3 ，还出错估计没装 pip)</li>
<li>建立一个项目（也就是新建文件夹），方便统筹。</li>
</ol>
<h1 id="创建窗口"><a href="#创建窗口" class="headerlink" title="创建窗口"></a>创建窗口</h1><p><strong>alien_invasion.py</strong></p>
<hr>
<pre><code>import sys
import pygame

def run_game():
    # 初始化游戏并创建一个屏幕对象
    pygame.init()
    screen = pygame.display.set_mode((1200, 800))
    pygame.display.set_caption(&quot;Alien Invasion&quot;)

    # 开始游戏的主循环
    while True:

        # 监视键盘和鼠标事件
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                sys.exit()

        # 让最近绘制的屏幕可见
        pygame.display.flip()

run_game()
</code></pre><p>代码解析：</p>
<ol>
<li>开头 pygame.init() 初始化背景设置。</li>
<li>pygame.display.set_mode() 的调用创建名为 screen 的显示窗口，这个游戏的所有图形元素都将在其中绘制。实参(1200, 800)是一个元组，指定了游戏窗口的尺寸。</li>
<li>对象 screen 是一个 surface。在 Pygame 中， surface 是屏幕的一部分，用于显示游戏元素。</li>
<li>Alien Invasion 是窗口的名称，也可以叫游戏名。</li>
<li>设定游戏主循环，并监视用户活动使其能够正常退出。</li>
<li>pygame.display.flip() 它在每次执行 while 循环时都绘制一个空屏幕，并擦去旧屏幕，使得只有新屏幕可见。（刷新）</li>
<li>调用 run_game()，初始化游戏并开始主循环。</li>
</ol>
<h1 id="添加背景色"><a href="#添加背景色" class="headerlink" title="添加背景色"></a>添加背景色</h1><p>在 while 主循环之前，写：</p>
<p><code>bg_color = (230, 230, 230)</code></p>
<p>只用写一次。<br>在 Pygame 中，颜色是以 RGB 值指定。<br>这种颜色由红色、绿色和蓝色值组成，其中每个值的可能取值范围都为 0~255。颜色值(255, 0, 0)表示红色， (0, 255, 0)表示绿色，而(0, 0, 255)表示蓝色。</p>
<p>将 <code>screen.fill(bg_color)</code> 写入 while 循环里面，用背景色填充屏幕。</p>
<p>代码成型：</p>
<pre><code>def run_game():
    # 初始化游戏并创建一个屏幕对象
    pygame.init()
    screen = pygame.display.set_mode((1200, 800))
    pygame.display.set_caption(&quot;Alien Invasion&quot;)    #窗口名称

    # 设置背景色，在Pygame中，颜色是以RGB值指定的。
    bg_color = (230, 230, 230)

    # 开始游戏的主循环
    while True:

        # 监视键盘和鼠标事件
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                sys.exit()

        # 每次循环时都重绘屏幕
        screen.fill(bg_color)

        # 让最近绘制的屏幕可见
        pygame.display.flip()

run_game()
</code></pre><h1 id="创建设置类"><a href="#创建设置类" class="headerlink" title="创建设置类"></a>创建设置类</h1><p>每次给游戏添加新功能时，通常也将引入一些新设置。下面来编写一个名为 settings 的模块，其中包含一个名为 Settings 的类，用于将所有设置存储在一个地方，以免在代码中到处添加设置。<br><strong>settings.py</strong></p>
<hr>
<pre><code>class Settings():
    &quot;&quot;&quot;存储《外星人入侵》的所有设置的类&quot;&quot;&quot;

    def __init__(self):
        &quot;&quot;&quot;初始化游戏的设置&quot;&quot;&quot;
        # 屏幕设置
        self.screen_width = 1200
        self.screen_height = 800
        self.bg_color = (230, 230, 230)
</code></pre><p>这时候主程序就不用那么复杂费劲：</p>
<pre><code>from settings import Settings

def run_game():
    # 初始化游戏并创建一个屏幕对象
    pygame.init()
    ai_settings = Settings()
    screen = pygame.display.set_mode(
        (ai_settings.screen_width, ai_settings.screen_height))
    pygame.display.set_caption(&quot;Alien Invasion&quot;)    #窗口名称

    # 开始游戏的主循环
    while True:

        # 监视键盘和鼠标事件
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                sys.exit()

        # 每次循环时都重绘屏幕
        screen.fill(ai_settings.bg_color)

        # 让最近绘制的屏幕可见
        pygame.display.flip()

run_game()
</code></pre><h1 id="添加飞船及为其创建类"><a href="#添加飞船及为其创建类" class="headerlink" title="添加飞船及为其创建类"></a>添加飞船及为其创建类</h1><p>在游戏中几乎可以使用任何类型的图像文件，但使用位图（.bmp）文件最为简单，因为 Pygame 默认加载位图。<br>如果用别人的图，注意版权，不想费钱可以到 <a href="http://pixabay.com/" target="_blank" rel="noopener">Pixabay</a> 下载想要的图片。<br>这里的飞船用的是原书提供的<a href="https://ehmatthes.github.io/pcc/" target="_blank" rel="noopener">教材资源</a> 。<br>在主项目文件夹内新建一个文件夹 (images) 用于存放飞船图片。</p>
<p>新建 Ship 类：<br><strong>ship.py</strong></p>
<hr>
<pre><code>import pygame

class Ship():

    def __init__(self, screen):        # screen 制定了要将飞船绘制到什么地方
        &quot;&quot;&quot;初始化飞船并设置其初始位置&quot;&quot;&quot;
        self.screen = screen

        # 加载飞船图像并获取其外接矩形
        self.image = pygame.image.load(&apos;images/ship.bmp&apos;)
        self.rect = self.image.get_rect()
        # 获取图像的外接矩形，这样就可以用矩形四角和中心的x和y坐标。可通过设置这些值来指定矩形的位置。
        self.screen_rect = screen.get_rect()
        # 将窗口矩形化

        # 将每艘新飞船放在屏幕底部中央
        self.rect.centerx = self.screen_rect.centerx
        self.rect.bottom = self.screen_rect.bottom

    def blitme(self):
        &quot;&quot;&quot;在指定位置绘制飞船&quot;&quot;&quot;
        self.screen.blit(self.image, self.rect)
</code></pre><p>要将游戏元素居中，可设置相应 rect 对象的属性 center、 centerx 或 centery。<br>要让游戏元素与屏幕边缘对齐，可使用属性 top、 bottom、 left 或 right。<br>要调整游戏元素的水平或垂直位置，可使用属性 x和 y，它们分别是相应矩形左上角的 x 和 y 坐标。<br>方法 blit()：于窗口中绘制图像。</p>
<p>注意：在Pygame中，原点(0, 0)位于屏幕左上角，向右下方移动时，坐标值将增大。在 1200×800 的屏幕上，原点位于左上角，而右下角的坐标为(1200, 800)。</p>
<h1 id="绘制飞船到主程序中"><a href="#绘制飞船到主程序中" class="headerlink" title="绘制飞船到主程序中"></a>绘制飞船到主程序中</h1><p>导入模块 ship:</p>
<pre><code>from ship import Ship

def run_game():
    --snip--
    pygame.display.set_caption(&quot;Alien Invasion&quot;)    #窗口名称

    # 创建飞船（要在主循环之前，以免每次都重建飞船）
    ship = Ship(screen)

    # 开始游戏的主循环
    while True:
        --snip--
        # 每次循环时都重绘屏幕
        screen.fill(ai_settings.bg_color)

        # 每次循环时都刷新飞船最新位置及图像
        ship.blitme()

        # 让最近绘制的屏幕可见
        pygame.display.flip()

run_game()
</code></pre><h1 id="重构：模块-game-functions"><a href="#重构：模块-game-functions" class="headerlink" title="重构：模块 game_functions"></a>重构：模块 game_functions</h1><p>我们不太可能把所有函数都写在主程序里面，不好维护，也不太好扩展。因此我们要建一个模块来存储游戏函数。<br><strong>game_functions.py</strong></p>
<hr>
<pre><code>import sys
import pygame

def check_events():
    &quot;&quot;&quot;监视键盘和鼠标事件&quot;&quot;&quot;
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            sys.exit()

# 有点特殊，当前不需要任何形参 （包括 self）。

def update_screen(ai_settings, screen, ship):
    &quot;&quot;&quot;更新屏幕上的图像，并切换到新屏幕&quot;&quot;&quot;
    # 每次循环时都重绘屏幕
    screen.fill(ai_settings.bg_color)
    ship.blitme()

    # 让最近绘制的屏幕可见
    pygame.display.flip()
</code></pre><p>注意一下，这里虽然用到 ship 参数，不代表要导入模块 ship ，它只是个形参。</p>
<p>然后改一下主函数：</p>
<pre><code>import pygame

from settings import Settings
from ship import Ship
import game_functions as gf

def run_game():
    --snip--
    # 开始游戏主循环
    while True:
        gf.check_events()
        gf.update_screen(ai_settings, screen, ship)
</code></pre><p>可以发现这次我们没有导入包 sys ，因为主函数不再需要，当前只有模块 game_functions 用到了它。<br>可以看到，主循环更加简单易懂，让我们后面做开发更容易一点。<br>所以一开始代码写得简单一些，项目越来越复杂的时候尽可能重构，让开发更简单点。</p>
<h1 id="驾驶飞船"><a href="#驾驶飞船" class="headerlink" title="驾驶飞船"></a>驾驶飞船</h1><h2 id="响应按键"><a href="#响应按键" class="headerlink" title="响应按键"></a>响应按键</h2><p>每当用户按键时，都将在Pygame中注册一个事件。事件都是通过方法 pygame.event.get() 获取的，因此在函数 check_events() 中，我们需要指定要检查哪些类型的事件。<br>每次按键都被注册为一个 KEYDOWN 事件。<br>现在我们设计 右方向键 → ，在模块 game_functions 中设计：</p>
<pre><code>def check_events(ship):
    &quot;&quot;&quot;监视键盘和鼠标事件&quot;&quot;&quot;
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            sys.exit()

        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_RIGHT:
                #向右移动飞船
                ship.rect.centerx += 1
</code></pre><p>然后，主程序调用需要更新下：<br>    gf.check_events(ship)    # 需要调用实参</p>
<h2 id="持续按键"><a href="#持续按键" class="headerlink" title="持续按键"></a>持续按键</h2><p>如果用户按住右箭头不放，当然是希望能持续移动。我们可以对飞船加个标识，当被按下右箭头时这个标识为 True ：</p>
<pre><code>class Ship():

    def __init__(self, screen):        # screen 制定了要将飞船绘制到什么地方
        &quot;&quot;&quot;初始化飞船并设置其初始位置&quot;&quot;&quot;
        self.screen = screen

        # 加载飞船图像并获取其外接矩形
        self.image = pygame.image.load(&apos;images/ship.bmp&apos;)
        self.rect = self.image.get_rect()
        # 获取图像的外接矩形，这样就可以用矩形四角和中心的 x 和 y 坐标。可通过设置这些值来指定矩形的位置
        self.screen_rect = screen.get_rect()
        # 将窗口矩形化

        # 将每艘新飞船放在屏幕底部中央
        self.rect.centerx = self.screen_rect.centerx
        self.rect.bottom = self.screen_rect.bottom


        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	# 移动标志</span><br><span class="line">	self.moving_right = False</span><br><span class="line"></span><br><span class="line">def update(self):</span><br><span class="line">	&quot;&quot;&quot;根据移动标志调整飞船的位置&quot;&quot;&quot;</span><br><span class="line">	if self.moving_right:</span><br><span class="line">	self.rect.centerx += 1</span><br></pre></td></tr></table></figure>



    def blitme(self):
        &quot;&quot;&quot;在指定位置绘制飞船&quot;&quot;&quot;
        self.screen.blit(self.image, self.rect)
</code></pre><p>这时候我们就修改一下模块 game_functions：</p>
<pre><code>def check_events(ship):
    &quot;&quot;&quot;响应按键和鼠标事件&quot;&quot;&quot;
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            sys.exit()

        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_RIGHT:
                ship.moving_right = True

        elif event.type == pygame.KEYUP:
            if event.key == pygame.K_RIGHT:
                ship.moving_right = False
</code></pre><p>最后，我们要整合到主程序里面：</p>
<pre><code>while True:
    gf.check_events(ship)
    `ship.update()`        #飞船的位置将在检测到键盘事件后（但在更新屏幕前）更新。
    gf.update_screen(ai_settings, screen, ship)
</code></pre><p>注意：新增语句要在屏幕刷新之前。</p>
<p>这时候试运行，可以看到飞船向右移动非常快。</p>
<h2 id="左右移动"><a href="#左右移动" class="headerlink" title="左右移动"></a>左右移动</h2><p>向右移动搞定，现在就搞左右移动。<br>最后成型的代码是这样的：<br><strong>alien_invasion.py</strong></p>
<hr>
<pre><code>import pygame

from settings import Settings
from ship import Ship
import game_functions as gf

def run_game():
    # 初始化游戏并创建一个屏幕对象
    pygame.init()
    ai_settings = Settings()
    screen = pygame.display.set_mode(
        (ai_settings.screen_width, ai_settings.screen_height))
    pygame.display.set_caption(&quot;Alien Invasion&quot;)    #窗口名称

    # 创建飞船
    ship = Ship(screen)

    # 开始游戏的主循环
    while True:
        gf.check_events(ship)
        ship.update()    # 飞船的位置将在检测到键盘事件后（但在更新屏幕前）更新。
        gf.update_screen(ai_settings, screen, ship)

run_game()
</code></pre><p><strong>ship.py</strong></p>
<hr>
<pre><code>import pygame

class Ship():

    def __init__(self, screen):
        &quot;&quot;&quot;初始化飞船并设置其初始位置&quot;&quot;&quot;
        self.screen = screen

        # 加载飞船图像并获取其外接矩形
        self.image = pygame.image.load(&apos;images/ship.bmp&apos;)
        self.rect = self.image.get_rect()
        self.screen_rect = screen.get_rect()

        # 将每艘新飞船放在屏幕底部中央
        self.rect.centerx = self.screen_rect.centerx
        self.rect.bottom = self.screen_rect.bottom

        # 移动标志
        self.moving_right = False
        self.moving_left = False

    def update(self):
        &quot;&quot;&quot;根据移动标志调整飞船的位置&quot;&quot;&quot;
        if self.moving_right:
            self.rect.centerx += 1
        # 这里不用 elif 的原因是玩家可能会同时按着两个键
        if self.moving_left:
            self.rect.centerx -= 1

    def blitme(self):
        &quot;&quot;&quot;在指定位置绘制飞船&quot;&quot;&quot;
        self.screen.blit(self.image, self.rect)
</code></pre><p><strong>game_functions.py</strong></p>
<hr>
<pre><code>import sys
import pygame

def check_events(ship):
    &quot;&quot;&quot;响应按键和鼠标事件&quot;&quot;&quot;
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            sys.exit()

        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_RIGHT:
                ship.moving_right = True
            # 这里之所以用 elif 代码块，是因为每个事件都只与一个键相关联；
            # 如果玩家同时按下了左右箭头键，将检测到两个不同的事件，俩事件相互独立的。
            elif event.key == pygame.K_LEFT:
                ship.moving_left = True

        elif event.type == pygame.KEYUP:
            if event.key == pygame.K_RIGHT:
                ship.moving_right = False
            elif event.key == pygame.K_LEFT:
                ship.moving_left = False

def update_screen(ai_settings, screen, ship):
    &quot;&quot;&quot;更新屏幕上的图像，并切换到新屏幕&quot;&quot;&quot;
    # 每次循环时都重绘屏幕
    screen.fill(ai_settings.bg_color)
    ship.blitme()

    # 让最近绘制的屏幕可见
    pygame.display.flip()
</code></pre><h2 id="飞船速度"><a href="#飞船速度" class="headerlink" title="飞船速度"></a>飞船速度</h2><p>当前飞船移动的像素是 1 。要想加速的话，我们可以在模块 settings.py 里面改：</p>
<pre><code>class Settings():
    &quot;&quot;&quot;存储《外星人入侵》的所有设置的类&quot;&quot;&quot;

    def __init__(self):
        &quot;&quot;&quot;初始化游戏的设置&quot;&quot;&quot;
        # 屏幕设置
        self.screen_width = 1200
        self.screen_height = 800
        self.bg_color = (230, 230, 230)

        # 飞船的设置
        self.ship_speed_factor = 1.5
</code></pre><p>看到这可能会奇怪，像素只能整型啊，所以我们要对 ship 修改一下：</p>
<p>注意 Ship 要添多一个形参 ai_settings</p>
<pre><code>def __init__(self, ai_settings, screen):
    &quot;&quot;&quot;初始化飞船并设置其初始位置&quot;&quot;&quot;
    self.screen = screen
    `self.ai_settings = ai_settings`

    # 加载飞船图像并获取其外接矩形
    ...

    # 将每艘新飞船放在屏幕底部中央
    ...

    # 在飞船的属性center中存储小数值
    self.center = float(self.rect.centerx)

    # 移动标志
    ...

def update(self):
    &quot;&quot;&quot;根据移动标志调整飞船的位置&quot;&quot;&quot;
    # 更新飞船的 center 值，而不是 rect
    if self.moving_right:
        self.center += self.ai_settings.ship_speed_factor
    if self.moving_left:
        self.center -= self.ai_settings.ship_speed_factor

    # 根据 self.center 更新 rect 对象
    self.rect.centerx = self.center
    &quot;&quot;&quot;
    注意，这一步很重要，就像 C 语言刚学的时候 a、b 两数交换一样：
    t = a;    a = b;    b = t;
    此时，浮点数转给 rect.centerx 的时候，小数部分会给砍掉，但对飞船而言，问题不大。
    &quot;&quot;&quot;
</code></pre><p>然后就是对主程序修改：</p>
<pre><code>def run_game():
    --snip--
    # 创建飞船
    ship = Ship(ai_settings, screen)
</code></pre><h1 id="限制飞船活动范围"><a href="#限制飞船活动范围" class="headerlink" title="限制飞船活动范围"></a>限制飞船活动范围</h1><p>发现没？一直按着方向键，他会出界，看不到飞船了。<br>要给 Ship() 加个撞墙机制。</p>
<pre><code>class Ship():
    def update(self):
        &quot;&quot;&quot;根据移动标志调整飞船的位置&quot;&quot;&quot;
        # 更新飞船的 center 值，而不是 rect
        if self.moving_right and self.rect.right &lt; self.screen_rect.right:
        # self.rect.right 是飞船图案的右边坐标
            self.center += self.ai_settings.ship_speed_factor
        if self.moving_left and self.rect.left &gt; 0:
            self.center -= self.ai_settings.ship_speed_factor

        # 根据self.center更新rect对象
        self.rect.centerx = self.center
</code></pre><h1 id="继续重构：game-functions"><a href="#继续重构：game-functions" class="headerlink" title="继续重构：game_functions"></a>继续重构：game_functions</h1><p>回过头来看，check_events() 还可以更精简一些，修一修：</p>
<pre><code>def check_keydown_events(event, ship):
    &quot;&quot;&quot;响应按键&quot;&quot;&quot;
    if event.key == pygame.K_RIGHT:
        ship.moving_right = True
    elif event.key == pygame.K_LEFT:
        ship.moving_left = True

def check_keyup_events(event, ship):
    &quot;&quot;&quot;响应松开&quot;&quot;&quot;
    if event.key == pygame.K_RIGHT:
        ship.moving_right = False
    elif event.key == pygame.K_LEFT:
        ship.moving_left = False

def check_events(ship):
    &quot;&quot;&quot;响应按键和鼠标事件&quot;&quot;&quot;
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            sys.exit()

        elif event.type == pygame.KEYDOWN:
            check_keydown_events(event, ship)
        elif event.type == pygame.KEYUP:
            check_keyup_events(event, ship)
</code></pre><h1 id="子弹"><a href="#子弹" class="headerlink" title="子弹"></a>子弹</h1><p>添加射击功能。子弹将在屏幕中向上穿行，抵达屏幕上边缘后消失。<br>更新 模块 settings.py：</p>
<pre><code>def __init__(self):
    --snip--
    # 子弹设置
    self.bullet_speed_factor = 1
    self.bullet_width = 3
    self.bullet_height = 15
    self.bullet_color = 60, 60, 60
</code></pre><p>建立一个新模块 bullet.py, 用于存放子弹相关设置。<br><strong>bullet.py</strong></p>
<hr>
<pre><code>import pygame
from pygame.sprite import Sprite

class Bullet(Sprite):
    &quot;&quot;&quot;一个对飞船发射的子弹进行管理的类&quot;&quot;&quot;

    def __init__(self, ai_settings, screen, ship):
        &quot;&quot;&quot;在飞船所处的位置创建一个子弹对象&quot;&quot;&quot;
        super().__init__()
        self.screen = screen

        # 在(0,0)处创建一个表示子弹的矩形，再设置正确的位置
        self.rect = pygame.Rect(0, 0, ai_settings.bullet_width, ai_settings.bullet_height)
        self.rect.centerx = ship.rect.centerx
        self.rect.top = ship.rect.top

        #存储用小数表示的子弹位置
        self.y = float(self.rect.y)
        self.color = ai_settings.bullet_color
        self.speed_factor = ai_settings.bullet_speed_factor

    def update(self):
        &quot;&quot;&quot;向上移动子弹&quot;&quot;&quot;
        #更新表示子弹位置的小数值
        self.y -= self.speed_factor
        #更新表示子弹的rect的位置
        self.rect.y = self.y

    def draw_bullet(self):
        &quot;&quot;&quot;在屏幕上绘制子弹&quot;&quot;&quot;
        pygame.draw.rect(self.screen, self.color, self.rect)
</code></pre><p>这里我们导入了精灵模块 (pygame.sprite) 中的 Sprite。这儿干嘛用的？为什么要有这个类呢？<br>举个例子大家就明白了。在一款 RPG 游戏中（如：口袋妖怪），我们的地图上有树林、小河等一系列地图元件。玩过此类游戏的同学都知道，如果我们的人物走到了地图中央继续前进的话，地图会进行卷轴移动，显示出下部分地图。这个时候我们如果要把每个地图元件进行移动，操作起来会相当麻烦。因此 flash 为我们提供的 Sprite 就是为了统一处理一系列显示对象而生的。<br>简单来讲就是会动的、可以和其他图像交互的图片。具体更详细的介绍，可以参考<a href="https://blog.csdn.net/zengxiantao1994/article/details/64922278" target="_blank" rel="noopener">这篇文章</a> 。</p>
<h1 id="导入子弹"><a href="#导入子弹" class="headerlink" title="导入子弹"></a>导入子弹</h1><p>子弹做好后，导入到主程序中：<br>这时还要导入模块 pygame.sprite 中的 Group 类（精灵组管理类），它类似于列表，但提供了有助于开发游戏的额外功能。</p>
<pre><code>import pygame
from pygame.sprite import Group
--snip--

def run_game():
    --snip--
    # 创建一艘飞船
    ship = Ship(ai_settings, screen)
    # 创建一个用于存储子弹的编组
    bullets = Group()
    &quot;&quot;&quot;
    如果在循环内部创建这样的编组，游戏运行时将创建数千个子弹编组，导致游戏慢得像蜗牛。如果游戏停滞不前，请仔细查看主while循环中发生的情况。
    &quot;&quot;&quot;

    # 开始游戏主循环
    while True:
        gf.check_events(ai_settings, screen, ship, bullets)
        ship.update()
        bullets.update()    # 这步看不懂的话注意一下接下来模块 game_functions.check_keydown_events() 函数的修改
        gf.update_screen(ai_settings, screen, ship, bullets)

run_game()
</code></pre><h1 id="开火功能"><a href="#开火功能" class="headerlink" title="开火功能"></a>开火功能</h1><p>这时候，子弹的构建差不多了，接下来就是响应玩家的按键事件。<br>修改模块 game_functions:<br>    from bullet import Bullet</p>
<pre><code>def check_keydown_events(event, ai_settings, screen, ship, bullets):
    &quot;&quot;&quot;响应按键&quot;&quot;&quot;
    if event.key == pygame.K_RIGHT:
        ship.moving_right = True
    elif event.key == pygame.K_LEFT:
        ship.moving_left = True
    elif event.key == pygame.K_SPACE:
        # 创建一颗子弹，并将其加入到编组 bullets 中
        new_bullet = Bullet(ai_settings, screen, ship)
        bullets.add(new_bullet)

def check_events(ai_settings, screen, ship, bullets):
    &quot;&quot;&quot;响应按键和鼠标事件&quot;&quot;&quot;
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            sys.exit()

        elif event.type == pygame.KEYDOWN:
            check_keydown_events(event, ai_settings, screen, ship, bullets)
        elif event.type == pygame.KEYUP:
            check_keyup_events(event, ship)
</code></pre><h1 id="内存释放"><a href="#内存释放" class="headerlink" title="内存释放"></a>内存释放</h1><p>其实，我们写出来的子弹都没消失，发射出去触顶后消失只是我们看不到界外而已，所以我们要让这些触顶子弹消失。<br>在主程序的 while 循环中修改：</p>
<pre><code># 删除已消失的子弹
for bullet in bullets.copy():
    if bullet.rect.bottom &lt;= 0:
        bullets.remove(bullet)
print(len(bullets))
</code></pre><p>上面的 print 语句只是为了检验一下代码有没有问题，子弹是否有被删除，没问题的话就删掉。<br>此外，在 for 循环中，不应从列表或编组中删除条目，因此必须遍历编组的副本。因为不能随便用切片法建立副本，而且我们要遍历的对象特殊（精灵动图），可能出错，所以我们用方法 copy() 建立副本（这方法属于 Group 类）。<br></p>
<h1 id="限制子弹数量（可选）"><a href="#限制子弹数量（可选）" class="headerlink" title="限制子弹数量（可选）"></a>限制子弹数量（可选）</h1><p>如果想给游戏增加难度，不妨限制一下子弹显示在屏幕的最大数量。<br>首先设置一下模块 settings.py，给子弹新增一个状态:<br><code>self.bullets_allowed = 3</code><br>表示子弹留存量只有 3 颗。<br>然后，在模块 game_functions 中写入检查看看还能不能再发射子弹：</p>
<pre><code>elif event.key == pygame.K_SPACE:
    # 创建一颗子弹，并将其加入到编组 bullets 中
    if len(bullets) &lt; ai_settings.bullets_allowed:
        new_bullet = Bullet(ai_settings, screen, ship)
        bullets.add(new_bullet)
</code></pre><h1 id="代码重构"><a href="#代码重构" class="headerlink" title="代码重构"></a>代码重构</h1><p>我们新增了限制子弹、发射子弹的功能，那能不能再精简一波？<br>试试创建函数 update_bullets()，用以保存子弹的刷新。</p>
<pre><code>def update_bullets(bullets):
    &quot;&quot;&quot;更新子弹的位置，并删除已消失的子弹&quot;&quot;&quot;
    # 更新子弹的位置
    bullets.update()

    # 删除已消失的子弹
    for bullet in bullets.copy():
        if bullet.rect.bottom &lt;= 0:
            bullets.remove(bullet)
</code></pre><p>这时候我们就可以把主程序中子弹相关的代码转移到模块 game_functions 了。<br>这时候，while 循环代码成了这样：</p>
<pre><code>while True:
    gf.check_events(ai_settings, screen, ship, bullets)
    ship.update()
    gf.update_bullets(bullets)
    gf.update_screen(ai_settings, screen, ship, bullets)
</code></pre><p>很简洁，一目了然。</p>
<p>接下来还可以继续重构发射子弹功能。</p>
<pre><code>def fire_bullet(ai_settings, screen, ship, bullets):
    &quot;&quot;&quot;如果还没有到达限制，就发射一颗子弹&quot;&quot;&quot;
    #创建新子弹，并将其加入到编组bullets中
    if len(bullets) &lt; ai_settings.bullets_allowed:
        new_bullet = Bullet(ai_settings, screen, ship)
        bullets.add(new_bullet)
</code></pre><p>然后 check_keydown_events() 函数就可以得到精简：</p>
<pre><code>elif event.key == pygame.K_SPACE:
    fire_bullet(ai_settings, screen, ship, bullets)
</code></pre><p>写到这里也可以明白了，不是说一开始就要追着代码精简力求规划整齐，而是先实现功能，再考虑代码重构，慢慢来。<br>如果想一上手就写好精致简洁的代码，在开发项目之前就要画好蓝图，想好要什么功能，如何将这些链接起来等等，所以整体观念很重要。</p>
<h1 id="学习要点"><a href="#学习要点" class="headerlink" title="学习要点"></a>学习要点</h1><pre><code>1. 游戏开发计划的如何制定
2. 如何使用 Pygame 编写游戏的基本结构
3. 如何设置背景色，以及如何将设置存储在可供游戏的各个部分访问的独立类中
4. 如何在屏幕上绘制图像，以及如何让玩家控制游戏元素的移动
5. 如何创建自动移动的元素，如在屏幕中向上飞驰的子弹，以及如何删除不再需要的对象
6. 如何定期重构项目的代码，为后续开发提供便利
</code></pre><h1 id="此部分各组件源码"><a href="#此部分各组件源码" class="headerlink" title="此部分各组件源码"></a>此部分各组件源码</h1><h2 id="alien-invasion-py"><a href="#alien-invasion-py" class="headerlink" title="alien_invasion.py"></a>alien_invasion.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import pygame</span><br><span class="line"></span><br><span class="line">from pygame.sprite import Group</span><br><span class="line">from settings import Settings</span><br><span class="line">from ship import Ship</span><br><span class="line">import game_functions as gf</span><br><span class="line"></span><br><span class="line">def run_game():</span><br><span class="line">	# 初始化游戏并创建一个屏幕对象</span><br><span class="line">	pygame.init()</span><br><span class="line">	ai_settings = Settings()</span><br><span class="line">	screen = pygame.display.set_mode(</span><br><span class="line">		(ai_settings.screen_width, ai_settings.screen_height))</span><br><span class="line">	pygame.display.set_caption(&quot;Alien Invasion&quot;)	#窗口名称</span><br><span class="line">	</span><br><span class="line">	# 创建飞船</span><br><span class="line">	ship = Ship(ai_settings, screen)</span><br><span class="line">	</span><br><span class="line">	# 创建一个用于存储子弹的编组</span><br><span class="line">	bullets = Group()</span><br><span class="line">	</span><br><span class="line">	# 开始游戏的主循环</span><br><span class="line">	while True:</span><br><span class="line">		gf.check_events(ai_settings, screen, ship, bullets)</span><br><span class="line">		ship.update()	# 飞船的位置将在检测到键盘事件后（但在更新屏幕前）更新</span><br><span class="line">		gf.update_bullets(bullets)</span><br><span class="line">		gf.update_screen(ai_settings, screen, ship, bullets)</span><br><span class="line"></span><br><span class="line">run_game()</span><br></pre></td></tr></table></figure>
<h2 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class Settings():</span><br><span class="line">	&quot;&quot;&quot;存储《外星人入侵》的所有设置的类&quot;&quot;&quot;</span><br><span class="line">	</span><br><span class="line">	def __init__(self):</span><br><span class="line">		&quot;&quot;&quot;初始化游戏的设置&quot;&quot;&quot;</span><br><span class="line">		# 屏幕设置</span><br><span class="line">		self.screen_width = 1200</span><br><span class="line">		self.screen_height = 800</span><br><span class="line">		self.bg_color = (230, 230, 230)</span><br><span class="line">		</span><br><span class="line">		# 飞船的设置</span><br><span class="line">		self.ship_speed_factor = 1.5</span><br><span class="line">		</span><br><span class="line">		# 子弹设置</span><br><span class="line">		self.bullet_speed_factor = 1</span><br><span class="line">		self.bullet_width = 3</span><br><span class="line">		self.bullet_height = 15</span><br><span class="line">		self.bullet_color = 60, 60, 60</span><br><span class="line">		self.bullets_allowed = 3</span><br></pre></td></tr></table></figure>
<h2 id="game-functions-py"><a href="#game-functions-py" class="headerlink" title="game_functions.py"></a>game_functions.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import pygame</span><br><span class="line">from bullet import Bullet</span><br><span class="line"></span><br><span class="line">def check_keydown_events(event, ai_settings, screen, ship, bullets):</span><br><span class="line">	&quot;&quot;&quot;响应按键&quot;&quot;&quot;</span><br><span class="line">	if event.key == pygame.K_RIGHT:</span><br><span class="line">		ship.moving_right = True</span><br><span class="line">	elif event.key == pygame.K_LEFT:</span><br><span class="line">		ship.moving_left = True</span><br><span class="line">	elif event.key == pygame.K_SPACE:</span><br><span class="line">		fire_bullet(ai_settings, screen, ship, bullets)</span><br><span class="line"></span><br><span class="line">def check_keyup_events(event, ship):</span><br><span class="line">	&quot;&quot;&quot;响应松开&quot;&quot;&quot;</span><br><span class="line">	if event.key == pygame.K_RIGHT:</span><br><span class="line">		ship.moving_right = False</span><br><span class="line">	elif event.key == pygame.K_LEFT:</span><br><span class="line">		ship.moving_left = False</span><br><span class="line"></span><br><span class="line">def check_events(ai_settings, screen, ship, bullets):</span><br><span class="line">	&quot;&quot;&quot;响应按键和鼠标事件&quot;&quot;&quot;</span><br><span class="line">	for event in pygame.event.get():</span><br><span class="line">		if event.type == pygame.QUIT:</span><br><span class="line">			sys.exit()</span><br><span class="line">			</span><br><span class="line">		elif event.type == pygame.KEYDOWN:</span><br><span class="line">			check_keydown_events(event, ai_settings, screen, ship, bullets)</span><br><span class="line">		elif event.type == pygame.KEYUP:</span><br><span class="line">			check_keyup_events(event, ship)</span><br><span class="line"></span><br><span class="line">def update_screen(ai_settings, screen, ship, bullets):</span><br><span class="line">	&quot;&quot;&quot;更新屏幕上的图像，并切换到新屏幕&quot;&quot;&quot;</span><br><span class="line">	# 每次循环时都重绘屏幕</span><br><span class="line">	screen.fill(ai_settings.bg_color)</span><br><span class="line">	# 重绘所有子弹</span><br><span class="line">	for bullet in bullets.sprites():</span><br><span class="line">		bullet.draw_bullet()</span><br><span class="line">	ship.blitme()</span><br><span class="line"></span><br><span class="line">	# 让最近绘制的屏幕可见</span><br><span class="line">	pygame.display.flip()</span><br><span class="line"></span><br><span class="line">def update_bullets(bullets):</span><br><span class="line">	&quot;&quot;&quot;更新子弹的位置，并删除已消失的子弹&quot;&quot;&quot;</span><br><span class="line">	# 更新子弹的位置</span><br><span class="line">	bullets.update()	# 这步看不懂的话注意一下模块 game_functions.check_keydown_events() 函数</span><br><span class="line">	</span><br><span class="line">	# 删除已消失的子弹</span><br><span class="line">	for bullet in bullets.copy():</span><br><span class="line">		if bullet.rect.bottom &lt;= 0:</span><br><span class="line">			bullets.remove(bullet)</span><br><span class="line"></span><br><span class="line">def fire_bullet(ai_settings, screen, ship, bullets):</span><br><span class="line">	&quot;&quot;&quot;如果还没有到达限制，就发射一颗子弹&quot;&quot;&quot;</span><br><span class="line">	#创建新子弹，并将其加入到编组bullets中</span><br><span class="line">	if len(bullets) &lt; ai_settings.bullets_allowed:</span><br><span class="line">		new_bullet = Bullet(ai_settings, screen, ship)</span><br><span class="line">		bullets.add(new_bullet)</span><br></pre></td></tr></table></figure>
<h2 id="ship-py"><a href="#ship-py" class="headerlink" title="ship.py"></a>ship.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import pygame</span><br><span class="line"></span><br><span class="line">class Ship():</span><br><span class="line"></span><br><span class="line">	def __init__(self, ai_settings, screen):</span><br><span class="line">		&quot;&quot;&quot;初始化飞船并设置其初始位置&quot;&quot;&quot;</span><br><span class="line">		self.screen = screen</span><br><span class="line">		self.ai_settings = ai_settings</span><br><span class="line">		</span><br><span class="line">		# 加载飞船图像并获取其外接矩形</span><br><span class="line">		self.image = pygame.image.load(&apos;images/ship.bmp&apos;)</span><br><span class="line">		self.rect = self.image.get_rect()</span><br><span class="line">		self.screen_rect = screen.get_rect()</span><br><span class="line">		</span><br><span class="line">		# 将每艘新飞船放在屏幕底部中央</span><br><span class="line">		self.rect.centerx = self.screen_rect.centerx</span><br><span class="line">		self.rect.bottom = self.screen_rect.bottom</span><br><span class="line">		</span><br><span class="line">		# 在飞船的属性center中存储小数值</span><br><span class="line">		self.center = float(self.rect.centerx)</span><br><span class="line">		</span><br><span class="line">		# 移动标志</span><br><span class="line">		self.moving_right = False</span><br><span class="line">		self.moving_left = False</span><br><span class="line">		</span><br><span class="line">	def update(self):</span><br><span class="line">		&quot;&quot;&quot;根据移动标志调整飞船的位置&quot;&quot;&quot;</span><br><span class="line">		# 更新飞船的 center 值，而不是 rect</span><br><span class="line">		if self.moving_right and self.rect.right &lt; self.screen_rect.right:</span><br><span class="line">		# self.rect.right 是飞船图案的右边坐标</span><br><span class="line">			self.center += self.ai_settings.ship_speed_factor</span><br><span class="line">		if self.moving_left and self.rect.left &gt; 0:</span><br><span class="line">			self.center -= self.ai_settings.ship_speed_factor</span><br><span class="line">			</span><br><span class="line">		# 根据self.center更新rect对象</span><br><span class="line">		self.rect.centerx = self.center</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">	def blitme(self):</span><br><span class="line">		&quot;&quot;&quot;在指定位置绘制飞船&quot;&quot;&quot;</span><br><span class="line">		self.screen.blit(self.image, self.rect)</span><br></pre></td></tr></table></figure>
<h2 id="bullet-py"><a href="#bullet-py" class="headerlink" title="bullet.py"></a>bullet.py</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import pygame</span><br><span class="line">from pygame.sprite import Sprite</span><br><span class="line"></span><br><span class="line">class Bullet(Sprite):</span><br><span class="line">	&quot;&quot;&quot;一个对飞船发射的子弹进行管理的类&quot;&quot;&quot;</span><br><span class="line">	</span><br><span class="line">	def __init__(self, ai_settings, screen, ship):</span><br><span class="line">		&quot;&quot;&quot;在飞船所处的位置创建一个子弹对象&quot;&quot;&quot;</span><br><span class="line">		super().__init__()</span><br><span class="line">		self.screen = screen</span><br><span class="line">		</span><br><span class="line">		# 在(0,0)处创建一个表示子弹的矩形，再设置正确的位置</span><br><span class="line">		self.rect = pygame.Rect(0, 0, ai_settings.bullet_width, ai_settings.bullet_height)</span><br><span class="line">		self.rect.centerx = ship.rect.centerx</span><br><span class="line">		self.rect.top = ship.rect.top</span><br><span class="line">		</span><br><span class="line">		#存储用小数表示的子弹位置</span><br><span class="line">		self.y = float(self.rect.y)</span><br><span class="line">		self.color = ai_settings.bullet_color</span><br><span class="line">		self.speed_factor = ai_settings.bullet_speed_factor</span><br><span class="line">	</span><br><span class="line">	def update(self):</span><br><span class="line">		&quot;&quot;&quot;向上移动子弹&quot;&quot;&quot;</span><br><span class="line">		#更新表示子弹位置的小数值</span><br><span class="line">		self.y -= self.speed_factor</span><br><span class="line">		#更新表示子弹的rect的位置</span><br><span class="line">		self.rect.y = self.y</span><br><span class="line">		</span><br><span class="line">	def draw_bullet(self):</span><br><span class="line">		&quot;&quot;&quot;在屏幕上绘制子弹&quot;&quot;&quot;</span><br><span class="line">		pygame.draw.rect(self.screen, self.color, self.rect)</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/ganru.github.io/tags/学习笔记/" rel="tag"># 学习笔记</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ganru.github.io/posts/Python笔记/2018-09-28-代码测试.html" rel="next" title="代码测试">
                <i class="fa fa-chevron-left"></i> 代码测试
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/ganru.github.io/posts/Python笔记/2018-10-07-小游戏之外星人入侵（第二部分）.html" rel="prev" title="小游戏之外星人入侵（第二部分）">
                小游戏之外星人入侵（第二部分） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/ganru.github.io/images/avatar.png"
                alt="Ganru" />
            
              <p class="site-author-name" itemprop="name">Ganru</p>
              <p class="site-description motion-element" itemprop="description">学习一向都是孤独的，慢慢玩。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/ganru.github.io/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ganru" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:ganr1988@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#创建窗口"><span class="nav-number">1.</span> <span class="nav-text">创建窗口</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#添加背景色"><span class="nav-number">2.</span> <span class="nav-text">添加背景色</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#创建设置类"><span class="nav-number">3.</span> <span class="nav-text">创建设置类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#添加飞船及为其创建类"><span class="nav-number">4.</span> <span class="nav-text">添加飞船及为其创建类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#绘制飞船到主程序中"><span class="nav-number">5.</span> <span class="nav-text">绘制飞船到主程序中</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#重构：模块-game-functions"><span class="nav-number">6.</span> <span class="nav-text">重构：模块 game_functions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#驾驶飞船"><span class="nav-number">7.</span> <span class="nav-text">驾驶飞船</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#响应按键"><span class="nav-number">7.1.</span> <span class="nav-text">响应按键</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#持续按键"><span class="nav-number">7.2.</span> <span class="nav-text">持续按键</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#左右移动"><span class="nav-number">7.3.</span> <span class="nav-text">左右移动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#飞船速度"><span class="nav-number">7.4.</span> <span class="nav-text">飞船速度</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#限制飞船活动范围"><span class="nav-number">8.</span> <span class="nav-text">限制飞船活动范围</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#继续重构：game-functions"><span class="nav-number">9.</span> <span class="nav-text">继续重构：game_functions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#子弹"><span class="nav-number">10.</span> <span class="nav-text">子弹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#导入子弹"><span class="nav-number">11.</span> <span class="nav-text">导入子弹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开火功能"><span class="nav-number">12.</span> <span class="nav-text">开火功能</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#内存释放"><span class="nav-number">13.</span> <span class="nav-text">内存释放</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#限制子弹数量（可选）"><span class="nav-number">14.</span> <span class="nav-text">限制子弹数量（可选）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#代码重构"><span class="nav-number">15.</span> <span class="nav-text">代码重构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#学习要点"><span class="nav-number">16.</span> <span class="nav-text">学习要点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#此部分各组件源码"><span class="nav-number">17.</span> <span class="nav-text">此部分各组件源码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#alien-invasion-py"><span class="nav-number">17.1.</span> <span class="nav-text">alien_invasion.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#settings-py"><span class="nav-number">17.2.</span> <span class="nav-text">settings.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#game-functions-py"><span class="nav-number">17.3.</span> <span class="nav-text">game_functions.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ship-py"><span class="nav-number">17.4.</span> <span class="nav-text">ship.py</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bullet-py"><span class="nav-number">17.5.</span> <span class="nav-text">bullet.py</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ganru</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/ganru.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/ganru.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/ganru.github.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/ganru.github.io/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/ganru.github.io/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/ganru.github.io/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/ganru.github.io/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/ganru.github.io/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/ganru.github.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
